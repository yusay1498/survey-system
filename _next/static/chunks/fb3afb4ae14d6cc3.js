(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,t)=>{s.exports=e.r(76562)},52683,e=>{"use strict";var s=e.i(43476),t=e.i(56348),a=e.i(71645);e.i(51718);var r=e.i(18357),l=e.i(59141);let n=async(e,s)=>{await (0,r.signInWithEmailAndPassword)(l.firebaseAuth,e,s)},i=()=>{let[e,t]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[i,d]=(0,a.useState)(!1),c=async()=>{d(!0);try{await n(e,r)}catch{alert("ログインに失敗しました")}finally{d(!1)}};return(0,s.jsxs)("div",{className:"p-4 border rounded space-y-2",children:[(0,s.jsx)("h2",{className:"font-bold",children:"管理者ログイン"}),(0,s.jsx)("input",{className:"border px-2 py-1 w-full",placeholder:"Email",value:e,onChange:e=>t(e.target.value)}),(0,s.jsx)("input",{className:"border px-2 py-1 w-full",type:"password",placeholder:"Password",value:r,onChange:e=>l(e.target.value)}),(0,s.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded w-full",onClick:c,disabled:i,children:"ログイン"})]})},d=async()=>(await (0,r.signInAnonymously)(l.firebaseAuth)).user,c=()=>{let e=async()=>{await d()};return(0,s.jsxs)("div",{className:"p-6 border rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4",children:"一般ユーザー"}),(0,s.jsx)("p",{className:"text-sm mb-4 text-gray-600",children:"アンケートに回答する場合はこちら"}),(0,s.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:e,children:"アンケートに回答する"})]})},o=()=>(0,s.jsxs)("main",{className:"p-6 max-w-2xl mx-auto space-y-6",children:[(0,s.jsx)("div",{className:"text-center mb-6",children:(0,s.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"アンケートシステム"})}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsx)(c,{}),(0,s.jsx)(i,{})]})]}),u=({onSubmit:e})=>{let[t,r]=(0,a.useState)("");return(0,s.jsxs)("div",{className:"max-w-sm mx-auto p-6 bg-white rounded-xl shadow",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4",children:"名前を入力してください"}),(0,s.jsx)("input",{className:"w-full border rounded px-3 py-2 mb-4",value:t,onChange:e=>r(e.target.value),placeholder:"表示名"}),(0,s.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50",disabled:!t,onClick:()=>e(t),children:"決定"})]})};var h=e.i(79268),x=e.i(79472);e.i(36180);var m=e.i(98925);let p=async e=>{await (0,m.addDoc)((0,m.collection)(l.firestore,"answers"),{userId:e.userId,userName:e.userName,questionId:e.questionId,selectedOption:e.selectedOption,createdAt:(0,m.serverTimestamp)()})},b=({userId:e,userName:t})=>{let[r,l]=(0,a.useState)([]),[n,i]=(0,a.useState)(0),[d,c]=(0,a.useState)(null),[o,u]=(0,a.useState)(!1),[m,b]=(0,a.useState)(!0),[g,j]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),[y,N]=(0,a.useState)(0),v=(0,a.useRef)([]);(0,a.useEffect)(()=>{(0,x.getQuestions)().then(e=>{l(e),b(!1)})},[]);let A=async s=>{if(g||!window.confirm(`「${s}」を選択して回答を送信しますか？

送信後は変更できません。`))return;c(s),j(!0);let a=r[n];try{await p({userId:e,userName:t,questionId:a.id,selectedOption:s,createdAt:new Date}),j(!1),u(!0)}catch(e){console.error("Failed to submit answer:",e),j(!1),c(null),alert("回答の送信に失敗しました。もう一度お試しください。")}};if((0,a.useEffect)(()=>{!o&&y>=0&&y<v.current.length&&v.current[y]&&v.current[y]?.focus()},[y,o]),m)return(0,s.jsx)("p",{children:"Loading..."});if(0===r.length)return(0,s.jsx)("p",{children:"現在、利用可能な質問がありません。"});if(w)return(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsx)(h.ResultList,{questions:r})});if(n<0||n>=r.length)return(0,s.jsx)("p",{children:"エラー: 質問が見つかりませんでした。"});let S=r[n];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"mb-4 text-gray-600",children:["質問 ",n+1," / ",r.length]}),o?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"p-4 bg-blue-100 border-2 border-blue-500 rounded",children:(0,s.jsxs)("p",{className:"font-bold text-blue-800",children:["あなたの回答: ",d]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-3",children:"この質問の集計結果"}),(0,s.jsx)(h.ResultList,{questions:[S]})]}),(0,s.jsx)("button",{className:"w-full bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition-colors",onClick:()=>{n<r.length-1?(i(n+1),c(null),u(!1),N(0),v.current=[]):f(!0)},children:n<r.length-1?"次の質問へ":"結果を見る"})]}):(0,s.jsxs)("div",{className:"p-6 border-2 rounded-lg bg-white shadow-lg",role:"radiogroup","aria-label":S.text,children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:S.text}),(0,s.jsx)("div",{className:"space-y-2",onKeyDown:e=>((e,s)=>{if(!g)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),N(e=>(e+1)%s);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),N(e=>(e-1+s)%s);break;case"Enter":case" ":e.preventDefault(),v.current[y]?.click()}})(e,S.options.length),children:S.options.map((e,t)=>(0,s.jsx)("button",{ref:e=>{v.current[t]=e},role:"radio","aria-checked":d===e,tabIndex:t===y?0:-1,className:`w-full text-left p-3 border-2 rounded transition-colors ${d===e?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-300 hover:bg-gray-50"} ${g?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>!g&&A(e),onFocus:()=>N(t),disabled:g,children:e},e))}),g&&(0,s.jsx)("p",{className:"mt-4 text-center text-gray-600",children:"送信中..."})]})]})},g=async e=>{let s=(0,m.doc)(l.firestore,"users",e.uid);await (0,m.setDoc)(s,{displayName:e.displayName,createdAt:(0,m.serverTimestamp)()})},j=({userId:e})=>{let[t,r]=(0,a.useState)(null);return t?(0,s.jsx)("main",{className:"p-6",children:(0,s.jsx)(b,{userId:e,userName:t})}):(0,s.jsx)("main",{className:"p-6",children:(0,s.jsx)(u,{onSubmit:async s=>{await g({uid:e,displayName:s,createdAt:new Date}),r(s)}})})};var w=e.i(18566);function f(){let{user:e,loading:a}=(0,t.useAuth)(),r=(0,w.useRouter)();return!e||a||e.isAnonymous?a?(0,s.jsx)("p",{className:"p-6",children:"Loading..."}):e?(0,s.jsx)(j,{userId:e.uid}):(0,s.jsx)(o,{}):(r.push("/admin"),(0,s.jsx)("p",{className:"p-6",children:"管理者画面に移動中..."}))}e.s(["default",()=>f],52683)}]);