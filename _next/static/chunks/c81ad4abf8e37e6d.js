(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16787,58594,48350,e=>{"use strict";var r=e.i(43476);let t=({size:e="md",label:t="読み込み中...",className:s=""})=>(0,r.jsxs)("div",{className:`flex items-center justify-center ${s}`,role:"status",children:[(0,r.jsx)("div",{className:`${{sm:"w-4 h-4 border-2",md:"w-8 h-8 border-2",lg:"w-12 h-12 border-4"}[e]} border-blue-200 border-t-blue-600 rounded-full animate-spin dark:border-gray-600 dark:border-t-blue-400`,"aria-hidden":"true"}),(0,r.jsx)("span",{className:"sr-only",children:t})]});e.s(["Spinner",0,t],58594),e.s(["LoadingScreen",0,({message:e="読み込み中..."})=>(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(t,{size:"lg",label:e}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 animate-pulse",children:e})]})})],48350),e.s([],16787)},72906,e=>{"use strict";var r=e.i(43476),t=e.i(56348),s=e.i(86134),a=e.i(85149);let d=async e=>(0,s.documentExists)(a.COLLECTIONS.ADMINS,e),l=e=>{let t="not-logged-in"===e.type;return(0,r.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,r.jsxs)("div",{className:`border rounded p-6 ${t?"bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-800"}`,children:[(0,r.jsx)("h2",{className:`text-xl font-bold mb-2 ${t?"text-red-800 dark:text-red-200":"text-yellow-800 dark:text-yellow-200"}`,children:t?"アクセス権限がありません":"管理者権限がありません"}),(0,r.jsx)("p",{className:`mb-4 ${t?"text-red-600 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:t?"管理者としてログインする必要があります。":(0,r.jsxs)(r.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,r.jsx)("br",{}),"UID: ",e.uid]})}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e.onAction,children:t?"ホームに戻る":"ログアウト"})]})})};var n=e.i(71645),i=e.i(79472),o=e.i(25026),c=e.i(80368);let x=async e=>(0,s.createDocument)(a.COLLECTIONS.QUESTIONS,e),m=async e=>{let{id:r,...t}=e;await (0,s.updateDocument)(a.COLLECTIONS.QUESTIONS,r,t)},u=async e=>{await (0,s.deleteDocument)(a.COLLECTIONS.QUESTIONS,e)},b=async e=>(0,s.createDocument)(a.COLLECTIONS.QUESTION_ANSWERS,e),h=async e=>{let{id:r,...t}=e;await (0,s.updateDocument)(a.COLLECTIONS.QUESTION_ANSWERS,r,t)},g=async e=>{await (0,s.deleteDocument)(a.COLLECTIONS.QUESTION_ANSWERS,e)},p=async e=>(0,s.createDocument)(a.COLLECTIONS.RESULT_PATTERNS,e),y=async e=>{let{id:r,...t}=e;await (0,s.updateDocument)(a.COLLECTIONS.RESULT_PATTERNS,r,t)},N=async e=>{await (0,s.deleteDocument)(a.COLLECTIONS.RESULT_PATTERNS,e)},j=({email:e,uid:t,onLogout:s})=>(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e||t})]}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:s,children:"ログアウト"})]});e.i(32832);var k=e.i(36841),v=e.i(72585);let E=()=>({questionId:"",name:"",message:"",description:"",condition:{selectedOption:""},order:0}),f=({questionAnswers:e,questions:t,onUpdate:s})=>{var d;let l,[i,o]=(0,n.useState)(null),[c,x]=(0,n.useState)(!1),[m,u]=(0,n.useState)(E()),p=()=>{u(E()),o(null),x(!1)},y=()=>{let e=(0,k.validateQuestionAnswerForm)(m.questionId,m.name,m.message,m.condition.selectedOption,t);return!e||(alert(e),!1)},N=async()=>{if(y())try{await b({questionId:m.questionId,name:m.name,message:m.message,description:m.description,condition:m.condition,order:m.order}),p(),s()}catch(e){(0,v.handleError)("質問回答パターンの作成に失敗しました",e,a.ERROR_MESSAGES.CREATE_QUESTION_ANSWER_FAILED)}},j=async()=>{if(i&&y())try{await h({id:i.id,questionId:m.questionId,name:m.name,message:m.message,description:m.description,condition:m.condition,order:m.order}),p(),s()}catch(e){(0,v.handleError)("質問回答パターンの更新に失敗しました",e,a.ERROR_MESSAGES.UPDATE_QUESTION_ANSWER_FAILED)}},f=async e=>{if((0,v.confirmAction)(a.CONFIRMATION_MESSAGES.DELETE_QUESTION_ANSWER))try{await g(e),s()}catch(e){(0,v.handleError)("質問回答パターンの削除に失敗しました",e,a.ERROR_MESSAGES.DELETE_QUESTION_ANSWER_FAILED)}},w=t.map(r=>({question:r,answers:e.filter(e=>e.questionId===r.id)}));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問回答パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{x(!0),o(null),u({...E(),order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-6",children:0===w.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"質問がありません。"}):w.map(({question:e,answers:t})=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:e.text}),0===t.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"この質問の回答パターンはまだありません"}):(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,r.jsx)("div",{className:"border rounded p-3 bg-gray-50 dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"font-bold",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["選択肢: ",e.condition.selectedOption]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-1 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{o(e),u({questionId:e.questionId,name:e.name,message:e.message,description:e.description||"",condition:{...e.condition},order:e.order}),x(!1)},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>f(e.id),children:"削除"})]})]})},e.id))})]},e.id))}),(c||i)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:i?"質問回答パターンを編集":"新規質問回答パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["質問 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.questionId,onChange:e=>u({...m,questionId:e.target.value,condition:{selectedOption:""}}),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),m.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["選択肢 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.condition.selectedOption,onChange:e=>u({...m,condition:{selectedOption:e.target.value}}),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(d=m.questionId,(l=t.find(e=>e.id===d))?l.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.name,onChange:e=>u({...m,name:e.target.value}),placeholder:"例: ポジティブタイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.message,onChange:e=>u({...m,message:e.target.value}),placeholder:"例: 素晴らしい選択です！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.description,onChange:e=>u({...m,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:m.order,onChange:e=>{let r=parseInt(e.target.value,10);u({...m,order:isNaN(r)?m.order:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"小さい方が優先して表示されます"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:p,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:i?j:N,children:i?"更新":"作成"})]})]})]})]})},w=()=>({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:0}),S=({patterns:e,questions:t,onUpdate:s})=>{let[d,l]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1),[c,x]=(0,n.useState)(w()),m=()=>{x(w()),l(null),o(!1)},u=()=>{let e=(0,k.validateResultPatternForm)(c.name,c.message,c.conditions.length);if(e)return alert(e),null;let r=c.conditions.filter(e=>{if(!e.questionId||!e.selectedOption.trim())return!1;let r=t.find(r=>r.id===e.questionId);return!!r&&!!r.options.includes(e.selectedOption)});if(0===r.length)return alert("少なくとも1つの有効な条件を設定してください"),null;let s=c.conditions.length-r.length;return s>0&&alert(`${s}件の無効な条件が除外されました。削除された質問や選択肢を参照している条件は保存できません。`),r},b=async()=>{let e=u();if(e)try{await p({name:c.name,message:c.message,description:c.description,conditions:e,priority:c.priority,order:c.order}),m(),s()}catch(e){(0,v.handleError)("結果パターンの作成に失敗しました",e,a.ERROR_MESSAGES.CREATE_RESULT_PATTERN_FAILED)}},h=async()=>{if(!d)return;let e=u();if(e)try{await y({id:d.id,name:c.name,message:c.message,description:c.description,conditions:e,priority:c.priority,order:c.order}),m(),s()}catch(e){(0,v.handleError)("結果パターンの更新に失敗しました",e,a.ERROR_MESSAGES.UPDATE_RESULT_PATTERN_FAILED)}},g=async e=>{if((0,v.confirmAction)(a.CONFIRMATION_MESSAGES.DELETE_RESULT_PATTERN))try{await N(e),s()}catch(e){(0,v.handleError)("結果パターンの削除に失敗しました",e,a.ERROR_MESSAGES.DELETE_RESULT_PATTERN_FAILED)}},j=(e,r,t)=>{let s=[...c.conditions];s[e]={...s[e],[r]:t},x({...c,conditions:s})};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"結果パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{o(!0),l(null),x({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===e.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"結果パターンがありません。新規作成してください。"}):e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"font-bold text-lg",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["優先度: ",e.priority]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2 dark:text-gray-400",children:e.description}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"条件:"}),(0,r.jsx)("ul",{className:"ml-4 space-y-1",children:e.conditions.map((e,s)=>{var a;let d;return(0,r.jsxs)("li",{children:["・",(a=e.questionId,(d=t.find(e=>e.id===a))?d.text:a?`削除された質問 (ID: ${a})`:"")," → 「",e.selectedOption,"」"]},s)})})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{l(e),x({name:e.name,message:e.message,description:e.description||"",conditions:[...e.conditions],priority:e.priority,order:e.order}),o(!1)},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>g(e.id),children:"削除"})]})]})},e.id))}),(i||d)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:d?"結果パターンを編集":"新規結果パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c.name,onChange:e=>x({...c,name:e.target.value}),placeholder:"例: リーダータイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c.message,onChange:e=>x({...c,message:e.target.value}),placeholder:"例: あなたは生まれながらのリーダーです！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c.description,onChange:e=>x({...c,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["条件（少なくとも1つ） ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2 dark:text-gray-400",children:"これらの条件がすべて満たされた場合にこの結果が表示されます"}),c.conditions.map((e,s)=>{var a;let d;return(0,r.jsx)("div",{className:"mb-3 p-3 border rounded bg-white dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"質問"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.questionId,onChange:e=>j(s,"questionId",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),e.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"選択肢"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.selectedOption,onChange:e=>j(s,"selectedOption",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(a=e.questionId,(d=t.find(e=>e.id===a))?d.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),c.conditions.length>1&&(0,r.jsx)("button",{className:"text-red-600 text-xs hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e;return e=c.conditions.filter((e,r)=>r!==s),void x({...c,conditions:e})},children:"この条件を削除"})]})},s)}),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>{x({...c,conditions:[...c.conditions,{questionId:"",selectedOption:""}]})},children:"+ 条件を追加"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"優先度"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c.priority,onChange:e=>{let r=parseInt(e.target.value,10);x({...c,priority:isNaN(r)?c.priority:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"高い方が優先してマッチします"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:c.order,onChange:e=>{let r=parseInt(e.target.value,10);x({...c,order:isNaN(r)?c.order:r})}})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:m,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:d?h:b,children:d?"更新":"作成"})]})]})]})]})},I=()=>({text:"",options:Array(a.UI_CONSTANTS.DEFAULT_OPTIONS_COUNT).fill(""),order:0}),O=({questions:e,onUpdate:t})=>{let[s,d]=(0,n.useState)(null),[l,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(I()),b=()=>{c(I()),d(null),i(!1)},h=()=>o.options.filter(e=>e.trim()),g=async()=>{let e=h(),r=(0,k.validateQuestionForm)(o.text,e);if(r)return void alert(r);try{await x({text:o.text,options:e,order:o.order}),b(),t()}catch(e){(0,v.handleError)("質問の作成に失敗しました",e,a.ERROR_MESSAGES.CREATE_QUESTION_FAILED)}},p=async()=>{if(!s)return;let e=h(),r=(0,k.validateQuestionForm)(o.text,e);if(r)return void alert(r);try{await m({id:s.id,text:o.text,options:e,order:o.order}),b(),t()}catch(e){(0,v.handleError)("質問の更新に失敗しました",e,a.ERROR_MESSAGES.UPDATE_QUESTION_FAILED)}},y=async e=>{if((0,v.confirmAction)(a.CONFIRMATION_MESSAGES.DELETE_QUESTION))try{await u(e),t()}catch(e){(0,v.handleError)("質問の削除に失敗しました",e,a.ERROR_MESSAGES.DELETE_QUESTION_FAILED)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{i(!0),d(null),c({...I(),order:e.length})},children:"新規質問作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,r.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400",children:e.options.map((e,t)=>(0,r.jsxs)("li",{children:["・",e]},t))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{d(e),c({text:e.text,options:[...e.options,""],order:e.order}),i(!1)},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>y(e.id),children:"削除"})]})]})},e.id))}),(l||s)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:s?"質問を編集":"新規質問"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.text,onChange:e=>c({...o,text:e.target.value}),placeholder:"質問を入力"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),o.options.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,r.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:e,onChange:e=>{let r=[...o.options];r[t]=e.target.value,c({...o,options:r})},placeholder:`選択肢 ${t+1}`}),t>=2&&(0,r.jsx)("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e=o.options.filter((e,r)=>r!==t);c({...o,options:e})},children:"削除"})]},t)),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>c({...o,options:[...o.options,""]}),children:"+ 選択肢を追加"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.order,onChange:e=>c({...o,order:parseInt(e.target.value)||0})})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:b,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:s?p:g,children:s?"更新":"作成"})]})]})]})]})};var T=e.i(79268);let C=({userEmail:e,userId:t,onLogout:s})=>{let[a,d]=(0,n.useState)([]),[l,x]=(0,n.useState)(!1),[m,u]=(0,n.useState)([]),[b,h]=(0,n.useState)(!1),[g,p]=(0,n.useState)([]),[y,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l||(0,i.getQuestions)().then(e=>{d(e),x(!0)}).catch(e=>{console.error("Failed to load questions:",e),x(!0)})},[l]),(0,n.useEffect)(()=>{b||(0,o.getResultPatterns)().then(e=>{u(e),h(!0)}).catch(e=>{console.error("Failed to load result patterns:",e),h(!0)})},[b]),(0,n.useEffect)(()=>{y||(0,c.getQuestionAnswers)().then(e=>{p(e),N(!0)}).catch(e=>{console.error("Failed to load question answers:",e),N(!0)})},[y]);let k=async()=>{d(await (0,i.getQuestions)())},v=async()=>{u(await (0,o.getResultPatterns)())},E=async()=>{p(await (0,c.getQuestionAnswers)())};return(0,r.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,r.jsx)(j,{email:e,uid:t,onLogout:s}),(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsx)(O,{questions:a,onUpdate:k}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(f,{questionAnswers:g,questions:a,onUpdate:E})}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(S,{patterns:m,questions:a,onUpdate:v})}),(0,r.jsxs)("div",{className:"border-t pt-6 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,r.jsx)(T.ResultList,{questions:a})]})]})]})};e.i(51718);var A=e.i(18357),R=e.i(59141);let _=async()=>{await (0,A.signOut)(R.auth)};e.i(16787);var L=e.i(48350);function U(){let{user:e,loading:s}=(0,t.useAuth)(),[a,i]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let r=async()=>{e&&i(await d(e.uid)),c(!1)};s||r()},[e,s]);let x=async()=>{await _(),window.location.href="/"};return s||o?(0,r.jsx)(L.LoadingScreen,{}):!e||e.isAnonymous?(0,r.jsx)(l,{type:"not-logged-in",onAction:()=>{window.location.href="/"}}):a?(0,r.jsx)(C,{userEmail:e.email,userId:e.uid,onLogout:x}):(0,r.jsx)(l,{type:"insufficient-permissions",uid:e.uid,onAction:x})}e.s(["default",()=>U],72906)}]);