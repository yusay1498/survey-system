(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72906,e=>{"use strict";var t=e.i(43476),s=e.i(56348);e.i(36180);var l=e.i(98925),r=e.i(59141);let o=async e=>{let t=(0,l.doc)(r.firestore,"admins",e);return(await (0,l.getDoc)(t)).exists()},a=({onBackToHome:e})=>(0,t.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,t.jsxs)("div",{className:"border rounded p-6 bg-red-50",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-red-800 mb-2",children:"アクセス権限がありません"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:"管理者としてログインする必要があります。"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:e,children:"ホームに戻る"})]})}),i=({uid:e,onLogout:s})=>(0,t.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,t.jsxs)("div",{className:"border rounded p-6 bg-yellow-50",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-yellow-800 mb-2",children:"管理者権限がありません"}),(0,t.jsxs)("p",{className:"text-yellow-700 mb-4",children:["このアカウントには管理者権限が付与されていません。",(0,t.jsx)("br",{}),"UID: ",e]}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:s,children:"ログアウト"})]})});var n=e.i(71645),d=e.i(79472);let c=async e=>(await (0,l.addDoc)((0,l.collection)(r.firestore,"questions"),{text:e.text,options:e.options,order:e.order,createdAt:(0,l.serverTimestamp)()})).id,x=async e=>{let t=(0,l.doc)(r.firestore,"questions",e.id);await (0,l.updateDoc)(t,{text:e.text,options:e.options,order:e.order})},u=async e=>{let t=(0,l.doc)(r.firestore,"questions",e);await (0,l.deleteDoc)(t)},m=({questions:e,onUpdate:s})=>{let[l,r]=(0,n.useState)(null),[o,a]=(0,n.useState)(!1),[i,d]=(0,n.useState)({text:"",options:["","",""],order:0}),m=()=>{d({text:"",options:["","",""],order:0}),r(null),a(!1)},h=async()=>{let e=i.options.filter(e=>e.trim());if(!i.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await c({text:i.text,options:e,order:i.order}),m(),s()}catch(e){console.error("質問の作成に失敗しました:",e),alert("質問の作成に失敗しました。もう一度お試しください。")}},b=async()=>{let e=i.options.filter(e=>e.trim());if(l){if(!i.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await x({id:l.id,text:i.text,options:e,order:i.order}),m(),s()}catch(e){console.error("質問の更新に失敗しました:",e),alert("質問の更新に失敗しました。もう一度お試しください。")}}},p=async e=>{if(confirm("この質問を削除しますか？"))try{await u(e),s()}catch(e){console.error("質問の削除に失敗しました:",e),alert("質問の削除に失敗しました。もう一度お試しください。")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,t.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",onClick:()=>{a(!0),r(null),d({text:"",options:["","",""],order:e.length})},children:"新規質問作成"})]}),(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsx)("div",{className:"border rounded p-4 bg-white shadow",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,t.jsx)("ul",{className:"ml-4 text-sm text-gray-600",children:e.options.map((e,s)=>(0,t.jsxs)("li",{children:["・",e]},s))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",onClick:()=>{r(e),d({text:e.text,options:[...e.options,""],order:e.order}),a(!1)},children:"編集"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",onClick:()=>p(e.id),children:"削除"})]})]})},e.id))}),(o||l)&&(0,t.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:l?"質問を編集":"新規質問"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:i.text,onChange:e=>d({...i,text:e.target.value}),placeholder:"質問を入力"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),i.options.map((e,s)=>(0,t.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,t.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2",value:e,onChange:e=>{let t=[...i.options];t[s]=e.target.value,d({...i,options:t})},placeholder:`選択肢 ${s+1}`}),s>=2&&(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800",onClick:()=>{let e=i.options.filter((e,t)=>t!==s);d({...i,options:e})},children:"削除"})]},s)),(0,t.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800",onClick:()=>d({...i,options:[...i.options,""]}),children:"+ 選択肢を追加"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:i.order,onChange:e=>d({...i,order:parseInt(e.target.value)||0})})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",onClick:m,children:"キャンセル"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:l?b:h,children:l?"更新":"作成"})]})]})]})]})};var h=e.i(79268);let b=({email:e,uid:s,onLogout:l})=>(0,t.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e||s})]}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",onClick:l,children:"ログアウト"})]}),p=({userEmail:e,userId:s,onLogout:l})=>{let[r,o]=(0,n.useState)([]),[a,i]=(0,n.useState)(!1);(0,n.useEffect)(()=>{a||(0,d.getQuestions)().then(e=>{o(e),i(!0)}).catch(e=>{console.error("Failed to load questions:",e),i(!0)})},[a]);let c=async()=>{o(await (0,d.getQuestions)())};return(0,t.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,t.jsx)(b,{email:e,uid:s,onLogout:l}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(m,{questions:r,onUpdate:c}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,t.jsx)(h.ResultList,{questions:r})]})]})]})};e.i(51718);var j=e.i(18357);let g=async()=>{await (0,j.signOut)(r.firebaseAuth)};function v(){let{user:e,loading:l}=(0,s.useAuth)(),[r,d]=(0,n.useState)(!1),[c,x]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let t=async()=>{e&&d(await o(e.uid)),x(!1)};l||t()},[e,l]);let u=async()=>{await g(),window.location.href="/"};return l||c?(0,t.jsx)("p",{className:"p-6",children:"Loading..."}):!e||e.isAnonymous?(0,t.jsx)(a,{onBackToHome:()=>{window.location.href="/"}}):r?(0,t.jsx)(p,{userEmail:e.email,userId:e.uid,onLogout:u}):(0,t.jsx)(i,{uid:e.uid,onLogout:u})}e.s(["default",()=>v],72906)}]);