(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16787,58594,48350,41635,e=>{"use strict";var r=e.i(43476);let s=({size:e="md",label:s="読み込み中...",className:t=""})=>(0,r.jsxs)("div",{className:`flex items-center justify-center ${t}`,role:"status",children:[(0,r.jsx)("div",{className:`${{sm:"w-4 h-4 border-2",md:"w-8 h-8 border-2",lg:"w-12 h-12 border-4"}[e]} border-blue-200 border-t-blue-600 rounded-full animate-spin dark:border-gray-600 dark:border-t-blue-400`,"aria-hidden":"true"}),(0,r.jsx)("span",{className:"sr-only",children:s})]});e.s(["Spinner",0,s],58594),e.s(["LoadingScreen",0,({message:e="読み込み中..."})=>(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(s,{size:"lg",label:e}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 animate-pulse",children:e})]})})],48350);let t={"gradient-blue":"bg-gradient-to-r from-blue-500 to-cyan-500 text-white shadow-md","gradient-purple":"bg-gradient-to-r from-purple-700 to-pink-700 text-white shadow-md","gradient-green":"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-md",default:"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 border-2 border-blue-200 dark:border-blue-700 shadow-lg"};e.s(["GradientCard",0,({children:e,className:s="",variant:a="default"})=>(0,r.jsx)("div",{className:`${t[a]} rounded-lg ${s}`,children:e})],41635),e.s([],16787)},18566,(e,r,s)=>{r.exports=e.r(76562)},52683,e=>{"use strict";var r=e.i(43476),s=e.i(56348),t=e.i(71645);e.i(51718);var a=e.i(18357),l=e.i(59141);let n=async(e,r)=>{await (0,a.signInWithEmailAndPassword)(l.auth,e,r)};e.i(16787);var d=e.i(58594);let i=()=>{let[e,s]=(0,t.useState)(""),[a,l]=(0,t.useState)(""),[i,o]=(0,t.useState)(!1),c=async()=>{o(!0);try{await n(e,a)}catch{alert("ログインに失敗しました")}finally{o(!1)}};return(0,r.jsxs)("div",{className:"p-4 border rounded space-y-2 dark:border-gray-700 dark:bg-gray-800",children:[(0,r.jsx)("h2",{className:"font-bold",children:"管理者ログイン"}),(0,r.jsx)("input",{className:"border px-2 py-1 w-full dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Email",value:e,onChange:e=>s(e.target.value)}),(0,r.jsx)("input",{className:"border px-2 py-1 w-full dark:border-gray-600 dark:bg-gray-700 dark:text-white",type:"password",placeholder:"Password",value:a,onChange:e=>l(e.target.value)}),(0,r.jsxs)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded w-full dark:bg-blue-500 dark:hover:bg-blue-600 flex items-center justify-center gap-2",onClick:c,disabled:i,children:[i&&(0,r.jsx)(d.Spinner,{size:"sm",label:"ログイン中..."}),"ログイン"]})]})},o=async()=>(await (0,a.signInAnonymously)(l.auth)).user,c=()=>{let e=async()=>{await o()};return(0,r.jsxs)("div",{className:"p-6 border rounded-lg shadow dark:border-gray-700 dark:bg-gray-800",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"一般ユーザー"}),(0,r.jsx)("p",{className:"text-sm mb-4 text-gray-600 dark:text-gray-400",children:"アンケートに回答する場合はこちら"}),(0,r.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e,children:"アンケートに回答する"})]})},u=()=>(0,r.jsxs)("main",{className:"p-6 max-w-2xl mx-auto space-y-6",children:[(0,r.jsx)("div",{className:"text-center mb-6",children:(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"アンケートシステム"})}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsx)(c,{}),(0,r.jsx)(i,{})]})]}),x=({onSubmit:e})=>{let[s,a]=(0,t.useState)("");return(0,r.jsxs)("div",{className:"max-w-sm mx-auto p-6 bg-white rounded-xl shadow dark:bg-gray-800 dark:border dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"名前を入力してください"}),(0,r.jsx)("input",{className:"w-full border rounded px-3 py-2 mb-4 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:s,onChange:e=>a(e.target.value),placeholder:"表示名"}),(0,r.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",disabled:!s,onClick:()=>e(s),children:"決定"})]})};var g=e.i(79268),b=e.i(77691),m=e.i(41635);let h=({userAnswers:e,pattern:s,questionAnswers:t,questions:a})=>{let l=e.map(e=>{let r=a.find(r=>r.id===e.questionId),s=(0,b.findMatchingQuestionAnswer)(e.questionId,e.selectedOption,t);return{answer:e,question:r,questionAnswer:s}});return s?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(m.GradientCard,{variant:"gradient-purple",className:"p-6",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold mb-3",children:s.name}),(0,r.jsx)("p",{className:"text-lg leading-relaxed",children:s.message}),s.description&&(0,r.jsx)("p",{className:"mt-4 text-base leading-relaxed",children:s.description})]}),e.length>0&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 p-3 bg-gray-50 rounded dark:bg-gray-800",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"あなたの回答:"}),(0,r.jsx)("ul",{className:"space-y-1",children:e.map((e,s)=>(0,r.jsxs)("li",{children:["・",e.selectedOption]},e.id??s))})]}),l.some(e=>e.questionAnswer)&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:"各質問のパーソナライズな回答"}),l.map((e,s)=>e.questionAnswer?(0,r.jsxs)("div",{className:"space-y-2",children:[e.question&&(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.question.text}),(0,r.jsxs)(m.GradientCard,{variant:"gradient-blue",className:"p-4",children:[(0,r.jsx)("h4",{className:"text-lg font-bold mb-1",children:e.questionAnswer.name}),(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:e.questionAnswer.message}),e.questionAnswer.description&&(0,r.jsx)("p",{className:"mt-2 text-xs leading-relaxed opacity-90",children:e.questionAnswer.description})]})]},e.answer.id??s):null)]})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"p-6 bg-gray-100 border-2 border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-2 text-gray-800 dark:text-gray-200",children:"アンケートが完了しました！"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"回答ありがとうございました。"})]}),l.some(e=>e.questionAnswer)&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-800 dark:text-gray-200",children:"各質問のパーソナライズな回答"}),l.map((e,s)=>e.questionAnswer?(0,r.jsxs)("div",{className:"space-y-2",children:[e.question&&(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:e.question.text}),(0,r.jsxs)(m.GradientCard,{variant:"gradient-blue",className:"p-4",children:[(0,r.jsx)("h4",{className:"text-lg font-bold mb-1",children:e.questionAnswer.name}),(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:e.questionAnswer.message}),e.questionAnswer.description&&(0,r.jsx)("p",{className:"mt-2 text-xs leading-relaxed opacity-90",children:e.questionAnswer.description})]})]},e.answer.id??s):null)]})]})};var p=e.i(77971),y=e.i(79472),j=e.i(80368),w=e.i(25026);e.i(36180);var f=e.i(98925),N=e.i(85149);let v=async e=>{await (0,f.addDoc)((0,f.collection)(l.db,N.COLLECTIONS.ANSWERS),{userId:e.userId,userName:e.userName,questionId:e.questionId,selectedOption:e.selectedOption,createdAt:(0,f.serverTimestamp)()})};e.i(45455),e.i(32832);var k=e.i(72585);let A=({userId:e,userName:s})=>{let[a,l]=(0,t.useState)([]),[n,i]=(0,t.useState)(0),[o,c]=(0,t.useState)(null),[u,x]=(0,t.useState)(!1),[m,f]=(0,t.useState)(!0),[A,S]=(0,t.useState)(!1),[I,q]=(0,t.useState)(!1),[O,C]=(0,t.useState)(!1),[R,E]=(0,t.useState)(0),Q=(0,t.useRef)([]),L=(0,t.useRef)(null),[T,_]=(0,t.useState)([]),[P,$]=(0,t.useState)([]),[D,F]=(0,t.useState)(null),[M,G]=(0,t.useState)([]),[U,z]=(0,t.useState)(null),B=`survey_progress_${e}`,W=`user_name_${e}`,J=(0,t.useCallback)(e=>{try{let r=localStorage.getItem(B),s={...r?JSON.parse(r):{},...e};localStorage.setItem(B,JSON.stringify(s))}catch(e){console.error("Failed to save progress:",e)}},[B]),K=(0,t.useCallback)(()=>{try{localStorage.removeItem(B),localStorage.removeItem(W)}catch(e){console.error("Failed to clear progress:",e)}},[B,W]);(0,t.useEffect)(()=>{Promise.all([(0,y.getQuestions)(),(0,w.getResultPatterns)(),(0,j.getQuestionAnswers)()]).then(([e,r,s])=>{l(e),$(r),G(s),f(!1)}).catch(e=>{console.error("Failed to load survey data:",e),S(!0),f(!1)})},[]),(0,t.useEffect)(()=>{if(0!==a.length&&!m&&L.current!==e)try{let r=localStorage.getItem(B);if(!r){L.current=e;return}let s=JSON.parse(r),t="number"==typeof s.currentQuestionIndex?s.currentQuestionIndex:0;if(!(t>=0&&t<a.length)){console.warn("Invalid currentQuestionIndex in saved progress"),L.current=e;return}let l=Array.isArray(s.userAnswers)?s.userAnswers:[];if(!l.every(e=>e&&"object"==typeof e&&"userId"in e&&"userName"in e&&"questionId"in e&&"selectedOption"in e)){console.warn("Invalid userAnswers in saved progress"),L.current=e;return}if(i(t),x(!!s.showResults),C(!!s.completed),_(l),c("string"==typeof s.selectedOption?s.selectedOption:null),s.completed&&null!=s.matchedPatternId){let e=P.find(e=>e.id===s.matchedPatternId);e&&F(e)}if(s.showResults&&null!=s.currentQuestionAnswerId){let e=M.find(e=>e.id===s.currentQuestionAnswerId);e&&z(e)}L.current=e}catch(e){console.error("Failed to restore progress:",e)}},[a,P,M,B,e,m]);let H=async r=>{if(I||!(0,k.confirmAction)(N.CONFIRMATION_MESSAGES.SUBMIT_ANSWER(r)))return;c(r),q(!0);let t=a[n];try{let a={userId:e,userName:s,questionId:t.id,selectedOption:r,createdAt:new Date};await v(a);let l=[...T,{...a,id:`${e}-${t.id}`}];_(l);let d=(0,b.findMatchingQuestionAnswer)(t.id,r,M);z(d),q(!1),x(!0),J({currentQuestionIndex:n,showResults:!0,selectedOption:r,userAnswers:l,completed:!1,currentQuestionAnswerId:d?.id||null})}catch(e){q(!1),c(null),(0,k.handleError)("Failed to submit answer",e,N.ERROR_MESSAGES.SUBMIT_ANSWER_FAILED)}},V=async()=>{if(n<a.length-1){let e=n+1;i(e),c(null),x(!1),z(null),E(0),Q.current=[],J({currentQuestionIndex:e,showResults:!1,selectedOption:null,userAnswers:T,completed:!1,currentQuestionAnswerId:null})}else{let e=null;try{e=function(e,r){if(0===e.length||0===r.length)return null;for(let s of[...r].sort((e,r)=>r.priority!==e.priority?r.priority-e.priority:r.conditions.length-e.conditions.length))if(0!==s.conditions.length&&s.conditions.every(r=>e.some(e=>e.questionId===r.questionId&&e.selectedOption===r.selectedOption)))return s;return null}(T,P),F(e)}catch(e){console.error("Failed to calculate result pattern:",e)}C(!0),J({currentQuestionIndex:n,showResults:!1,selectedOption:null,userAnswers:T,completed:!0,matchedPatternId:e?.id||null,currentQuestionAnswerId:null})}};if((0,t.useEffect)(()=>{!u&&R>=0&&R<Q.current.length&&Q.current[R]&&Q.current[R]?.focus()},[R,u]),m)return(0,r.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,r.jsx)(d.Spinner,{size:"lg",label:"アンケートを読み込んでいます..."})});if(A)return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"アンケートデータの読み込みに失敗しました。"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>window.location.reload(),children:"再読み込み"})]});if(0===a.length)return(0,r.jsx)("p",{children:"現在、利用可能な質問がありません。"});if(O)return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(h,{userAnswers:T,pattern:D,questionAnswers:M,questions:a}),(0,r.jsxs)("div",{className:"border-t-2 border-gray-300 dark:border-gray-600 pt-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"全体の集計結果"}),(0,r.jsx)(g.ResultList,{questions:a})]}),(0,r.jsx)("div",{className:"mt-6 flex justify-center",children:(0,r.jsx)("button",{className:"bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition-colors dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{K(),window.location.href=N.BASE_PATH+"/"},children:"ホームに戻る"})})]});if(n<0||n>=a.length)return(0,r.jsx)("p",{children:"エラー: 質問が見つかりませんでした。"});let X=a[n];return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"mb-4 text-gray-600 dark:text-gray-400",children:["質問 ",n+1," / ",a.length]}),u?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"p-4 bg-blue-100 border-2 border-blue-500 rounded dark:bg-blue-900 dark:border-blue-400",children:(0,r.jsxs)("p",{className:"font-bold text-blue-800 dark:text-blue-200",children:["あなたの回答: ",o]})}),U&&(0,r.jsx)(p.QuestionPersonalizedAnswer,{questionAnswer:U}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-3",children:"この質問の集計結果"}),(0,r.jsx)(g.ResultList,{questions:[X]})]}),(0,r.jsx)("button",{className:"w-full bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition-colors dark:bg-green-500 dark:hover:bg-green-600",onClick:V,children:n<a.length-1?"次の質問へ":"結果を見る"})]}):(0,r.jsxs)("div",{className:"p-6 border-2 rounded-lg bg-white shadow-lg dark:bg-gray-800 dark:border-gray-700",role:"radiogroup","aria-label":X.text,children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:X.text}),(0,r.jsx)("div",{className:"space-y-2",onKeyDown:e=>((e,r)=>{if(!I)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),E(e=>(e+1)%r);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),E(e=>(e-1+r)%r);break;case"Enter":case" ":e.preventDefault(),Q.current[R]?.click()}})(e,X.options.length),children:X.options.map((e,s)=>(0,r.jsx)("button",{ref:e=>{Q.current[s]=e},role:"radio","aria-checked":o===e,tabIndex:s===R?0:-1,className:`w-full text-left p-3 border-2 rounded transition-colors ${o===e?"border-blue-500 bg-blue-50 dark:bg-blue-900 dark:border-blue-400":"border-gray-300 hover:border-blue-300 hover:bg-gray-50 dark:border-gray-600 dark:hover:border-blue-500 dark:hover:bg-gray-700"} ${I?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>!I&&H(e),onFocus:()=>E(s),disabled:I,children:e},e))}),I&&(0,r.jsx)("div",{className:"mt-4 flex items-center justify-center",children:(0,r.jsx)(d.Spinner,{size:"sm",label:"送信中..."})})]})]})},S=async e=>{let r=(0,f.doc)(l.db,N.COLLECTIONS.USERS,e.uid);await (0,f.setDoc)(r,{displayName:e.displayName,createdAt:(0,f.serverTimestamp)()})};var I=e.i(53902),q=e.i(48350);let O=({userId:e})=>{let[s,t,,a]=(0,I.useLocalStorage)(`user_name_${e}`,null);return a?(0,r.jsx)(q.LoadingScreen,{message:"読み込み中..."}):s?(0,r.jsx)("main",{className:"p-6",children:(0,r.jsx)(A,{userId:e,userName:s},e)}):(0,r.jsx)("main",{className:"p-6",children:(0,r.jsx)(x,{onSubmit:async r=>{await S({uid:e,displayName:r,createdAt:new Date}),t(r)}})})};var C=e.i(18566);function R(){let{user:e,loading:t}=(0,s.useAuth)(),a=(0,C.useRouter)();return!e||t||e.isAnonymous?t?(0,r.jsx)(q.LoadingScreen,{}):e?(0,r.jsx)(O,{userId:e.uid}):(0,r.jsx)(u,{}):(a.push("/admin"),(0,r.jsx)(q.LoadingScreen,{message:"管理者画面に移動中..."}))}e.s(["default",()=>R],52683)}]);