(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72906,e=>{"use strict";var t=e.i(43476),r=e.i(56348);e.i(36180);var s=e.i(98925),a=e.i(59141);let d=async e=>{let t=(0,s.doc)(a.firestore,"admins",e);return(await (0,s.getDoc)(t)).exists()},o=e=>{let r="not-logged-in"===e.type;return(0,t.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,t.jsxs)("div",{className:`border rounded p-6 ${r?"bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-800"}`,children:[(0,t.jsx)("h2",{className:`text-xl font-bold mb-2 ${r?"text-red-800 dark:text-red-200":"text-yellow-800 dark:text-yellow-200"}`,children:r?"アクセス権限がありません":"管理者権限がありません"}),(0,t.jsx)("p",{className:`mb-4 ${r?"text-red-600 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:r?"管理者としてログインする必要があります。":(0,t.jsxs)(t.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,t.jsx)("br",{}),"UID: ",e.uid]})}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e.onAction,children:r?"ホームに戻る":"ログアウト"})]})})};var l=e.i(71645),i=e.i(79472);let n=async e=>(await (0,s.addDoc)((0,s.collection)(a.firestore,"questions"),{text:e.text,options:e.options,order:e.order,createdAt:(0,s.serverTimestamp)()})).id,c=async e=>{let t=(0,s.doc)(a.firestore,"questions",e.id);await (0,s.updateDoc)(t,{text:e.text,options:e.options,order:e.order})},x=async e=>{let t=(0,s.doc)(a.firestore,"questions",e);await (0,s.deleteDoc)(t)},u=({questions:e,onUpdate:r})=>{let[s,a]=(0,l.useState)(null),[d,o]=(0,l.useState)(!1),[i,u]=(0,l.useState)({text:"",options:["","",""],order:0}),b=()=>{u({text:"",options:["","",""],order:0}),a(null),o(!1)},h=async()=>{let e=i.options.filter(e=>e.trim());if(!i.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await n({text:i.text,options:e,order:i.order}),b(),r()}catch(e){console.error("質問の作成に失敗しました:",e),alert("質問の作成に失敗しました。もう一度お試しください。")}},m=async()=>{let e=i.options.filter(e=>e.trim());if(s){if(!i.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await c({id:s.id,text:i.text,options:e,order:i.order}),b(),r()}catch(e){console.error("質問の更新に失敗しました:",e),alert("質問の更新に失敗しました。もう一度お試しください。")}}},g=async e=>{if(confirm("この質問を削除しますか？"))try{await x(e),r()}catch(e){console.error("質問の削除に失敗しました:",e),alert("質問の削除に失敗しました。もう一度お試しください。")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,t.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{o(!0),a(null),u({text:"",options:["","",""],order:e.length})},children:"新規質問作成"})]}),(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,t.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400",children:e.options.map((e,r)=>(0,t.jsxs)("li",{children:["・",e]},r))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{a(e),u({text:e.text,options:[...e.options,""],order:e.order}),o(!1)},children:"編集"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>g(e.id),children:"削除"})]})]})},e.id))}),(d||s)&&(0,t.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:s?"質問を編集":"新規質問"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.text,onChange:e=>u({...i,text:e.target.value}),placeholder:"質問を入力"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),i.options.map((e,r)=>(0,t.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,t.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:e,onChange:e=>{let t=[...i.options];t[r]=e.target.value,u({...i,options:t})},placeholder:`選択肢 ${r+1}`}),r>=2&&(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e=i.options.filter((e,t)=>t!==r);u({...i,options:e})},children:"削除"})]},r)),(0,t.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>u({...i,options:[...i.options,""]}),children:"+ 選択肢を追加"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.order,onChange:e=>u({...i,order:parseInt(e.target.value)||0})})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:b,children:"キャンセル"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:s?m:h,children:s?"更新":"作成"})]})]})]})]})};var b=e.i(79268);let h=({email:e,uid:r,onLogout:s})=>(0,t.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e||r})]}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:s,children:"ログアウト"})]}),m=({userEmail:e,userId:r,onLogout:s})=>{let[a,d]=(0,l.useState)([]),[o,n]=(0,l.useState)(!1);(0,l.useEffect)(()=>{o||(0,i.getQuestions)().then(e=>{d(e),n(!0)}).catch(e=>{console.error("Failed to load questions:",e),n(!0)})},[o]);let c=async()=>{d(await (0,i.getQuestions)())};return(0,t.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,t.jsx)(h,{email:e,uid:r,onLogout:s}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(u,{questions:a,onUpdate:c}),(0,t.jsxs)("div",{className:"border-t pt-6 dark:border-gray-700",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,t.jsx)(b.ResultList,{questions:a})]})]})]})};e.i(51718);var g=e.i(18357);let p=async()=>{await (0,g.signOut)(a.firebaseAuth)};function y(){let{user:e,loading:s}=(0,r.useAuth)(),[a,i]=(0,l.useState)(!1),[n,c]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let t=async()=>{e&&i(await d(e.uid)),c(!1)};s||t()},[e,s]);let x=async()=>{await p(),window.location.href="/"};return s||n?(0,t.jsx)("p",{className:"p-6",children:"Loading..."}):!e||e.isAnonymous?(0,t.jsx)(o,{type:"not-logged-in",onAction:()=>{window.location.href="/"}}):a?(0,t.jsx)(m,{userEmail:e.email,userId:e.uid,onLogout:x}):(0,t.jsx)(o,{type:"insufficient-permissions",uid:e.uid,onAction:x})}e.s(["default",()=>y],72906)}]);