(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,r,t)=>{r.exports=e.r(76562)},52683,e=>{"use strict";var r=e.i(43476),t=e.i(56348),a=e.i(71645);e.i(51718);var s=e.i(18357),l=e.i(59141);let d=async(e,r)=>{await (0,s.signInWithEmailAndPassword)(l.firebaseAuth,e,r)},n=()=>{let[e,t]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),[n,i]=(0,a.useState)(!1),o=async()=>{i(!0);try{await d(e,s)}catch{alert("ログインに失敗しました")}finally{i(!1)}};return(0,r.jsxs)("div",{className:"p-4 border rounded space-y-2 dark:border-gray-700 dark:bg-gray-800",children:[(0,r.jsx)("h2",{className:"font-bold",children:"管理者ログイン"}),(0,r.jsx)("input",{className:"border px-2 py-1 w-full dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Email",value:e,onChange:e=>t(e.target.value)}),(0,r.jsx)("input",{className:"border px-2 py-1 w-full dark:border-gray-600 dark:bg-gray-700 dark:text-white",type:"password",placeholder:"Password",value:s,onChange:e=>l(e.target.value)}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded w-full dark:bg-blue-500 dark:hover:bg-blue-600",onClick:o,disabled:n,children:"ログイン"})]})},i=async()=>(await (0,s.signInAnonymously)(l.firebaseAuth)).user,o=()=>{let e=async()=>{await i()};return(0,r.jsxs)("div",{className:"p-6 border rounded-lg shadow dark:border-gray-700 dark:bg-gray-800",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"一般ユーザー"}),(0,r.jsx)("p",{className:"text-sm mb-4 text-gray-600 dark:text-gray-400",children:"アンケートに回答する場合はこちら"}),(0,r.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e,children:"アンケートに回答する"})]})},c=()=>(0,r.jsxs)("main",{className:"p-6 max-w-2xl mx-auto space-y-6",children:[(0,r.jsx)("div",{className:"text-center mb-6",children:(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"アンケートシステム"})}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsx)(o,{}),(0,r.jsx)(n,{})]})]}),u=({onSubmit:e})=>{let[t,s]=(0,a.useState)("");return(0,r.jsxs)("div",{className:"max-w-sm mx-auto p-6 bg-white rounded-xl shadow dark:bg-gray-800 dark:border dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"名前を入力してください"}),(0,r.jsx)("input",{className:"w-full border rounded px-3 py-2 mb-4 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:t,onChange:e=>s(e.target.value),placeholder:"表示名"}),(0,r.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 dark:bg-blue-500 dark:hover:bg-blue-600",disabled:!t,onClick:()=>e(t),children:"決定"})]})};var b=e.i(79268);let g=({userAnswers:e,pattern:t})=>t?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-6 bg-gradient-to-r from-purple-700 to-pink-700 rounded-lg text-white shadow-lg",children:[(0,r.jsx)("h2",{className:"text-3xl font-bold mb-3",children:t.name}),(0,r.jsx)("p",{className:"text-lg leading-relaxed",children:t.message}),t.description&&(0,r.jsx)("p",{className:"mt-4 text-base leading-relaxed",children:t.description})]}),e.length>0&&(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 p-3 bg-gray-50 rounded dark:bg-gray-800",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"あなたの回答:"}),(0,r.jsx)("ul",{className:"space-y-1",children:e.map((e,t)=>(0,r.jsxs)("li",{children:["・",e.selectedOption]},e.id??t))})]})]}):(0,r.jsxs)("div",{className:"p-6 bg-gray-100 border-2 border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-2 text-gray-800 dark:text-gray-200",children:"アンケートが完了しました！"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"回答ありがとうございました。"})]});var x=e.i(79472);e.i(36180);var h=e.i(98925);let p=async e=>{await (0,h.addDoc)((0,h.collection)(l.firestore,"answers"),{userId:e.userId,userName:e.userName,questionId:e.questionId,selectedOption:e.selectedOption,createdAt:(0,h.serverTimestamp)()})},m=async()=>{let e=(0,h.query)((0,h.collection)(l.firestore,"resultPatterns"),(0,h.orderBy)("priority","desc"));return(await (0,h.getDocs)(e)).docs.map(e=>{let r=e.data(),t="string"==typeof r.name?r.name:"",a="string"==typeof r.message?r.message:"",s="string"==typeof r.description?r.description:void 0,l=(Array.isArray(r.conditions)?r.conditions:[]).filter(e=>e&&"object"==typeof e&&"string"==typeof e.questionId&&"string"==typeof e.selectedOption),d="number"==typeof r.priority?r.priority:0,n="number"==typeof r.order?r.order:0,i="function"==typeof r.createdAt?.toDate?r.createdAt.toDate():new Date;return{id:e.id,name:t,message:a,description:s,conditions:l,priority:d,order:n,createdAt:i}})},y=({userId:e,userName:t})=>{let[s,l]=(0,a.useState)([]),[d,n]=(0,a.useState)(0),[i,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1),[h,y]=(0,a.useState)(!0),[f,j]=(0,a.useState)(!1),[k,N]=(0,a.useState)(!1),[w,v]=(0,a.useState)(!1),[A,S]=(0,a.useState)(0),D=(0,a.useRef)([]),[I,C]=(0,a.useState)([]),[q,O]=(0,a.useState)([]),[R,P]=(0,a.useState)(null);(0,a.useEffect)(()=>{Promise.all([(0,x.getQuestions)(),m()]).then(([e,r])=>{l(e),O(r),y(!1)}).catch(e=>{console.error("Failed to load survey data:",e),j(!0),y(!1)})},[]);let T=async r=>{if(k||!window.confirm(`「${r}」を選択して回答を送信しますか？

送信後は変更できません。`))return;o(r),N(!0);let a=s[d];try{let s={userId:e,userName:t,questionId:a.id,selectedOption:r,createdAt:new Date};await p(s),C(r=>[...r,{...s,id:`${e}-${a.id}`}]),N(!1),u(!0)}catch(e){console.error("Failed to submit answer:",e),N(!1),o(null),alert("回答の送信に失敗しました。もう一度お試しください。")}},E=async()=>{if(d<s.length-1)n(d+1),o(null),u(!1),S(0),D.current=[];else try{let e=function(e,r){if(0===e.length||0===r.length)return null;for(let t of[...r].sort((e,r)=>r.priority!==e.priority?r.priority-e.priority:r.conditions.length-e.conditions.length))if(0!==t.conditions.length&&t.conditions.every(r=>e.some(e=>e.questionId===r.questionId&&e.selectedOption===r.selectedOption)))return t;return null}(I,q);P(e),v(!0)}catch(e){console.error("Failed to calculate result pattern:",e),v(!0)}};if((0,a.useEffect)(()=>{!c&&A>=0&&A<D.current.length&&D.current[A]&&D.current[A]?.focus()},[A,c]),h)return(0,r.jsx)("p",{children:"Loading..."});if(f)return(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"アンケートデータの読み込みに失敗しました。"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>window.location.reload(),children:"再読み込み"})]});if(0===s.length)return(0,r.jsx)("p",{children:"現在、利用可能な質問がありません。"});if(w)return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(g,{userAnswers:I,pattern:R}),(0,r.jsxs)("div",{className:"border-t-2 border-gray-300 dark:border-gray-600 pt-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4 text-gray-800 dark:text-gray-200",children:"全体の集計結果"}),(0,r.jsx)(b.ResultList,{questions:s})]})]});if(d<0||d>=s.length)return(0,r.jsx)("p",{children:"エラー: 質問が見つかりませんでした。"});let L=s[d];return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"mb-4 text-gray-600 dark:text-gray-400",children:["質問 ",d+1," / ",s.length]}),c?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"p-4 bg-blue-100 border-2 border-blue-500 rounded dark:bg-blue-900 dark:border-blue-400",children:(0,r.jsxs)("p",{className:"font-bold text-blue-800 dark:text-blue-200",children:["あなたの回答: ",i]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-3",children:"この質問の集計結果"}),(0,r.jsx)(b.ResultList,{questions:[L]})]}),(0,r.jsx)("button",{className:"w-full bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 transition-colors dark:bg-green-500 dark:hover:bg-green-600",onClick:E,children:d<s.length-1?"次の質問へ":"結果を見る"})]}):(0,r.jsxs)("div",{className:"p-6 border-2 rounded-lg bg-white shadow-lg dark:bg-gray-800 dark:border-gray-700",role:"radiogroup","aria-label":L.text,children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:L.text}),(0,r.jsx)("div",{className:"space-y-2",onKeyDown:e=>((e,r)=>{if(!k)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),S(e=>(e+1)%r);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),S(e=>(e-1+r)%r);break;case"Enter":case" ":e.preventDefault(),D.current[A]?.click()}})(e,L.options.length),children:L.options.map((e,t)=>(0,r.jsx)("button",{ref:e=>{D.current[t]=e},role:"radio","aria-checked":i===e,tabIndex:t===A?0:-1,className:`w-full text-left p-3 border-2 rounded transition-colors ${i===e?"border-blue-500 bg-blue-50 dark:bg-blue-900 dark:border-blue-400":"border-gray-300 hover:border-blue-300 hover:bg-gray-50 dark:border-gray-600 dark:hover:border-blue-500 dark:hover:bg-gray-700"} ${k?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>!k&&T(e),onFocus:()=>S(t),disabled:k,children:e},e))}),k&&(0,r.jsx)("p",{className:"mt-4 text-center text-gray-600 dark:text-gray-400",children:"送信中..."})]})]})},f=async e=>{let r=(0,h.doc)(l.firestore,"users",e.uid);await (0,h.setDoc)(r,{displayName:e.displayName,createdAt:(0,h.serverTimestamp)()})},j=({userId:e})=>{let[t,s]=(0,a.useState)(null);return t?(0,r.jsx)("main",{className:"p-6",children:(0,r.jsx)(y,{userId:e,userName:t})}):(0,r.jsx)("main",{className:"p-6",children:(0,r.jsx)(u,{onSubmit:async r=>{await f({uid:e,displayName:r,createdAt:new Date}),s(r)}})})};var k=e.i(18566);function N(){let{user:e,loading:a}=(0,t.useAuth)(),s=(0,k.useRouter)();return!e||a||e.isAnonymous?a?(0,r.jsx)("p",{className:"p-6",children:"Loading..."}):e?(0,r.jsx)(j,{userId:e.uid}):(0,r.jsx)(c,{}):(s.push("/admin"),(0,r.jsx)("p",{className:"p-6",children:"管理者画面に移動中..."}))}e.s(["default",()=>N],52683)}]);