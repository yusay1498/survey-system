(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14603,e=>{"use strict";var r=e.i(43476),t=e.i(56867),a=e.i(85149);e.s(["AdminMenu",0,({userEmail:e,userId:s,onLogout:d})=>(0,r.jsxs)("main",{className:"p-6 max-w-4xl mx-auto",children:[(0,r.jsx)(t.AdminHeader,{email:e,userId:s,onLogout:d}),(0,r.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,r.jsxs)("a",{href:`${a.BASE_PATH}/admin/questions`,className:"block p-8 border rounded-lg bg-white shadow hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"質問編集"})]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"アンケートの質問、回答選択肢、結果パターンを管理します"})]}),(0,r.jsxs)("a",{href:`${a.BASE_PATH}/admin/results`,className:"block p-8 border rounded-lg bg-white shadow hover:shadow-lg transition-shadow dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"アンケート結果確認"})]}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"ユーザーから送信されたアンケート結果を確認します"})]})]})]})])},16787,58594,48350,41635,e=>{"use strict";var r=e.i(43476);let t=({size:e="md",label:t="読み込み中...",className:a=""})=>(0,r.jsxs)("div",{className:`flex items-center justify-center ${a}`,role:"status",children:[(0,r.jsx)("div",{className:`${{sm:"w-4 h-4 border-2",md:"w-8 h-8 border-2",lg:"w-12 h-12 border-4"}[e]} border-blue-200 border-t-blue-600 rounded-full animate-spin dark:border-gray-600 dark:border-t-blue-400`,"aria-hidden":"true"}),(0,r.jsx)("span",{className:"sr-only",children:t})]});e.s(["Spinner",0,t],58594),e.s(["LoadingScreen",0,({message:e="読み込み中..."})=>(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(t,{size:"lg",label:e}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 animate-pulse",children:e})]})})],48350);let a={"gradient-blue":"bg-gradient-to-r from-blue-500 to-cyan-500 text-white shadow-md","gradient-purple":"bg-gradient-to-r from-purple-700 to-pink-700 text-white shadow-md","gradient-green":"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-md",default:"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 border-2 border-blue-200 dark:border-blue-700 shadow-lg"};e.s(["GradientCard",0,({children:e,className:t="",variant:s="default"})=>(0,r.jsx)("div",{className:`${a[s]} rounded-lg ${t}`,children:e})],41635),e.s([],16787)},95241,14131,67856,56867,3380,e=>{"use strict";var r=e.i(71645),t=e.i(56348),a=e.i(86134),s=e.i(85149);let d=async e=>(0,a.documentExists)(s.COLLECTIONS.ADMINS,e);e.s(["isAdmin",0,d],14131),e.s(["useAdminAccess",0,()=>{let{user:e,loading:a}=(0,t.useAuth)(),[s,i]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!0),o=(0,r.useRef)(void 0);return(0,r.useEffect)(()=>{let r=!1,t=async()=>{let t=e?.uid??null;if(e&&!e.isAnonymous)try{let a=await d(e.uid);if(r)return;i(a),o.current=t}catch(e){if(r)return;console.error("管理者権限の確認に失敗しました:",e),i(!1),o.current=t}finally{if(r)return;l(!1)}else{if(r)return;i(!1),o.current=t,l(!1)}};if(!a){let r=e?.uid??null;o.current!==r&&(l(!0),t())}return()=>{r=!0}},[e,a]),{user:e,loading:a,isAdminUser:s,checking:n}}],95241);var i=e.i(43476);e.s(["UnauthorizedAccess",0,e=>{let r="not-logged-in"===e.type;return(0,i.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,i.jsxs)("div",{className:`border rounded p-6 ${r?"bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-800"}`,children:[(0,i.jsx)("h2",{className:`text-xl font-bold mb-2 ${r?"text-red-800 dark:text-red-200":"text-yellow-800 dark:text-yellow-200"}`,children:r?"アクセス権限がありません":"管理者権限がありません"}),(0,i.jsx)("p",{className:`mb-4 ${r?"text-red-600 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:r?"管理者としてログインする必要があります。":(0,i.jsxs)(i.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,i.jsx)("br",{}),"UID: ",e.uid]})}),(0,i.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e.onAction,children:r?"ホームに戻る":"ログアウト"})]})})}],67856),e.s(["AdminHeader",0,({email:e,userId:r,onLogout:t})=>(0,i.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e||r})]}),(0,i.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:t,children:"ログアウト"})]})],56867),e.i(51718);var n=e.i(18357),l=e.i(59141);let o=async()=>{await (0,n.signOut)(l.auth)};e.s(["signOut",0,o],3380)},37904,e=>{"use strict";var r=e.i(43476),t=e.i(79472),a=e.i(79268),s=e.i(56867);e.i(32832);var d=e.i(56309);e.i(16787);var i=e.i(58594),n=e.i(85149);e.s(["ResultScreen",0,({userEmail:e,userId:l,onLogout:o})=>{let{data:c,loading:x}=(0,d.useAsyncData)(t.getQuestions);return x?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(i.Spinner,{size:"lg",label:"アンケート結果を読み込んでいます..."})}):(0,r.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,r.jsx)(s.AdminHeader,{email:e,userId:l,onLogout:o}),(0,r.jsxs)("div",{className:"mb-6 flex gap-4",children:[(0,r.jsx)("a",{href:`${n.BASE_PATH}/admin`,className:"px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"← 管理画面トップ"}),(0,r.jsx)("a",{href:`${n.BASE_PATH}/admin/questions`,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",children:"質問編集 →"})]}),(0,r.jsx)("div",{className:"space-y-8",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,r.jsx)(a.ResultList,{questions:c||[]})]})})]})}])},79472,e=>{"use strict";var r=e.i(86134),t=e.i(85149);let a=async()=>(0,r.getCollection)(t.COLLECTIONS.QUESTIONS,"order","asc");e.s(["getQuestions",0,a])},80368,e=>{"use strict";var r=e.i(86134),t=e.i(85149);let a=async()=>(0,r.getCollection)(t.COLLECTIONS.QUESTION_ANSWERS,"order","asc");e.s(["getQuestionAnswers",0,a])},32832,36841,72585,56309,53902,52928,e=>{"use strict";var r=e.i(85149);e.s(["validateQuestionAnswerForm",0,(e,t,a,s,d)=>{if(!e)return r.VALIDATION_MESSAGES.REQUIRED_QUESTION_SELECT;if(!t.trim())return r.VALIDATION_MESSAGES.REQUIRED_PATTERN_NAME;if(!a.trim())return r.VALIDATION_MESSAGES.REQUIRED_MESSAGE;if(!s.trim())return r.VALIDATION_MESSAGES.REQUIRED_OPTION_SELECT;let i=d.find(r=>r.id===e);return i?i.options.includes(s)?void 0:r.VALIDATION_MESSAGES.OPTION_NOT_IN_QUESTION:r.VALIDATION_MESSAGES.QUESTION_NOT_FOUND},"validateQuestionForm",0,(e,t)=>e.trim()?t.filter(e=>e.trim()).length<r.UI_CONSTANTS.MIN_OPTIONS?r.VALIDATION_MESSAGES.REQUIRED_OPTIONS:void 0:r.VALIDATION_MESSAGES.REQUIRED_QUESTION_TEXT,"validateResultPatternForm",0,(e,t,a)=>e.trim()?t.trim()?a<r.UI_CONSTANTS.MIN_CONDITIONS?r.VALIDATION_MESSAGES.REQUIRED_CONDITIONS:void 0:r.VALIDATION_MESSAGES.REQUIRED_MESSAGE:r.VALIDATION_MESSAGES.REQUIRED_RESULT_NAME],36841),e.s(["confirmAction",0,e=>window.confirm(e),"handleError",0,(e,r,t)=>{console.error(`${e}:`,r),alert(t)}],72585);var t=e.i(71645);function a(e,r=[]){let[s,d]=(0,t.useState)(void 0),[i,n]=(0,t.useState)(!0),[l,o]=(0,t.useState)(void 0),c=(0,t.useRef)(void 0),x=(0,t.useCallback)(async()=>{c.current&&c.current.abort();let r=new AbortController;c.current=r;try{n(!0),o(void 0);let t=await e();c.current!==r||r.signal.aborted||d(t)}catch(e){c.current!==r||r.signal.aborted||(o(e instanceof Error?e:Error(String(e))),console.error("Failed to load data:",e))}finally{c.current!==r||r.signal.aborted||n(!1)}},[e]);return(0,t.useEffect)(()=>(x(),()=>{c.current&&c.current.abort()}),r),{data:s,loading:i,error:l,refresh:x}}function s(e,r){let[a,s]=(0,t.useState)(r),[d,i]=(0,t.useState)(!1),[n,l]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{i(!0),l(!0);try{let r=window.localStorage.getItem(e);r&&s(JSON.parse(r))}catch(r){console.error(`Error loading localStorage key "${e}":`,r)}finally{l(!1)}},[e]),[a,(0,t.useCallback)(r=>{try{s(t=>{let a=r instanceof Function?r(t):r;return d&&window.localStorage.setItem(e,JSON.stringify(a)),a})}catch(r){console.error(`Error saving localStorage key "${e}":`,r)}},[e,d]),(0,t.useCallback)(()=>{try{s(r),d&&window.localStorage.removeItem(e)}catch(r){console.error(`Error clearing localStorage key "${e}":`,r)}},[e,r,d]),n]}function d(e){let[r,a]=(0,t.useState)(void 0),[s,d]=(0,t.useState)(!1),[i,n]=(0,t.useState)(e()),l=(0,t.useCallback)(()=>{n(e()),a(void 0),d(!1)},[e]),o=(0,t.useCallback)((e,r)=>{a(e),n(r(e)),d(!1)},[]),c=(0,t.useCallback)(r=>{d(!0),a(void 0),n({...e(),...r})},[e]);return{editing:r,isCreating:s,formData:i,setFormData:n,resetForm:l,startEdit:o,startCreate:c}}e.s(["useAsyncData",()=>a],56309),e.s(["useLocalStorage",()=>s],53902),e.s(["useCRUDManager",()=>d],52928),e.s([],32832)},45455,e=>{"use strict";e.i(36180);var r=e.i(98925),t=e.i(59141),a=e.i(85149);e.s(["watchResults",0,e=>{let s=(0,r.query)((0,r.collection)(t.db,a.COLLECTIONS.ANSWERS),(0,r.orderBy)("createdAt","asc"));return(0,r.onSnapshot)(s,r=>{e(r.docs.map(e=>({id:e.id,...e.data()})))})}])},79268,77691,77971,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(45455),s=e.i(80368);function d(e,r,t){let a=t.filter(t=>t.questionId===e&&t.condition.selectedOption===r);if(0!==a.length)return a.sort((e,r)=>e.order!==r.order?e.order-r.order:e.id.localeCompare(r.id)),a[0]}e.s(["findMatchingQuestionAnswer",()=>d],77691),e.i(16787);var i=e.i(41635);let n=({questionAnswer:e})=>(0,r.jsxs)(i.GradientCard,{variant:"gradient-blue",className:"p-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-2",children:e.name}),(0,r.jsx)("p",{className:"text-base leading-relaxed",children:e.message}),e.description&&(0,r.jsx)("p",{className:"mt-2 text-sm leading-relaxed opacity-90",children:e.description})]});e.s(["QuestionPersonalizedAnswer",0,n],77971),e.s(["ResultList",0,({questions:e})=>{let[i,l]=(0,t.useState)([]),[o,c]=(0,t.useState)([]),[x,u]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{let e=(0,a.watchResults)(l);return()=>e()},[]),(0,t.useEffect)(()=>{let e=!0;return(0,s.getQuestionAnswers)().then(r=>{e&&(c(r),u(!1))}).catch(r=>{console.error("Failed to load question answers:",r),e&&u(!1)}),()=>{e=!1}},[]),(0,r.jsx)("div",{className:"space-y-6",children:e.map(e=>{let t=i.filter(r=>r.questionId===e.id);return(0,r.jsxs)("div",{className:"border rounded p-4 dark:border-gray-700 dark:bg-gray-800",children:[(0,r.jsx)("h3",{className:"font-bold mb-2",children:e.text}),e.options.map(a=>{let s=t.filter(e=>e.selectedOption===a),i=x?null:d(e.id,a,o);return(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("span",{className:"font-medium",children:[a,"（",s.length,"）"]}),i&&(0,r.jsx)("div",{className:"mt-2 ml-4",children:(0,r.jsx)(n,{questionAnswer:i})}),(0,r.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400 mt-2",children:s.map(e=>(0,r.jsxs)("li",{children:["・",e.userName]},e.id))})]},a)})]},e.id)})})}],79268)},25026,e=>{"use strict";e.i(36180);var r=e.i(98925),t=e.i(59141),a=e.i(85149);let s=async()=>{let e=(0,r.query)((0,r.collection)(t.db,a.COLLECTIONS.RESULT_PATTERNS),(0,r.orderBy)("priority","desc"));return(await (0,r.getDocs)(e)).docs.map(e=>{let r=e.data(),t="string"==typeof r.name?r.name:"",a="string"==typeof r.message?r.message:"",s="string"==typeof r.description?r.description:void 0,d=(Array.isArray(r.conditions)?r.conditions:[]).filter(e=>e&&"object"==typeof e&&"string"==typeof e.questionId&&"string"==typeof e.selectedOption),i="number"==typeof r.priority?r.priority:0,n="number"==typeof r.order?r.order:0,l="function"==typeof r.createdAt?.toDate?r.createdAt.toDate():new Date;return{id:e.id,name:t,message:a,description:s,conditions:d,priority:i,order:n,createdAt:l}})};e.s(["getResultPatterns",0,s])},56187,e=>{"use strict";var r=e.i(43476),t=e.i(95241),a=e.i(67856),s=e.i(79472),d=e.i(25026),i=e.i(80368),n=e.i(86134),l=e.i(85149);let o=async e=>(0,n.createDocument)(l.COLLECTIONS.QUESTIONS,e),c=async e=>{let{id:r,...t}=e;await (0,n.updateDocument)(l.COLLECTIONS.QUESTIONS,r,t)},x=async e=>{await (0,n.deleteDocument)(l.COLLECTIONS.QUESTIONS,e)},u=async e=>(0,n.createDocument)(l.COLLECTIONS.QUESTION_ANSWERS,e),m=async e=>{let{id:r,...t}=e;await (0,n.updateDocument)(l.COLLECTIONS.QUESTION_ANSWERS,r,t)},g=async e=>{await (0,n.deleteDocument)(l.COLLECTIONS.QUESTION_ANSWERS,e)},h=async e=>(0,n.createDocument)(l.COLLECTIONS.RESULT_PATTERNS,e),b=async e=>{let{id:r,...t}=e;await (0,n.updateDocument)(l.COLLECTIONS.RESULT_PATTERNS,r,t)},p=async e=>{await (0,n.deleteDocument)(l.COLLECTIONS.RESULT_PATTERNS,e)};e.i(14131),e.i(32832);var y=e.i(36841),N=e.i(72585),j=e.i(52928);let v=()=>({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:0}),k=({patterns:e,questions:t,onUpdate:a})=>{let{editing:s,isCreating:d,formData:i,setFormData:n,resetForm:o,startEdit:c,startCreate:x}=(0,j.useCRUDManager)(v),u=()=>{let e=(0,y.validateResultPatternForm)(i.name,i.message,i.conditions.length);if(e)return void alert(e);let r=i.conditions.filter(e=>{if(!e.questionId||!e.selectedOption.trim())return!1;let r=t.find(r=>r.id===e.questionId);return!!r&&!!r.options.includes(e.selectedOption)});if(0===r.length)return void alert("少なくとも1つの有効な条件を設定してください");let a=i.conditions.length-r.length;return a>0&&alert(`${a}件の無効な条件が除外されました。削除された質問や選択肢を参照している条件は保存できません。`),r},m=async()=>{let e=u();if(e)try{await h({name:i.name,message:i.message,description:i.description,conditions:e,priority:i.priority,order:i.order}),o(),a()}catch(e){(0,N.handleError)("結果パターンの作成に失敗しました",e,l.ERROR_MESSAGES.CREATE_RESULT_PATTERN_FAILED)}},g=async()=>{if(!s)return;let e=u();if(e)try{await b({id:s.id,name:i.name,message:i.message,description:i.description,conditions:e,priority:i.priority,order:i.order}),o(),a()}catch(e){(0,N.handleError)("結果パターンの更新に失敗しました",e,l.ERROR_MESSAGES.UPDATE_RESULT_PATTERN_FAILED)}},k=async e=>{if((0,N.confirmAction)(l.CONFIRMATION_MESSAGES.DELETE_RESULT_PATTERN))try{await p(e),a()}catch(e){(0,N.handleError)("結果パターンの削除に失敗しました",e,l.ERROR_MESSAGES.DELETE_RESULT_PATTERN_FAILED)}},E=(e,r,t)=>{let a=[...i.conditions];a[e]={...a[e],[r]:t},n({...i,conditions:a})};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"結果パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{x({conditions:[{questionId:"",selectedOption:""}],priority:10,order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===e.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"結果パターンがありません。新規作成してください。"}):e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"font-bold text-lg",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["優先度: ",e.priority]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2 dark:text-gray-400",children:e.description}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"条件:"}),(0,r.jsx)("ul",{className:"ml-4 space-y-1",children:e.conditions.map((e,a)=>{var s;let d;return(0,r.jsxs)("li",{children:["・",(s=e.questionId,(d=t.find(e=>e.id===s))?d.text:s?`削除された質問 (ID: ${s})`:"")," → 「",e.selectedOption,"」"]},a)})})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{c(e,e=>({name:e.name,message:e.message,description:e.description||"",conditions:[...e.conditions],priority:e.priority,order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>k(e.id),children:"削除"})]})]})},e.id))}),(d||s)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:s?"結果パターンを編集":"新規結果パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.name,onChange:e=>n({...i,name:e.target.value}),placeholder:"例: リーダータイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.message,onChange:e=>n({...i,message:e.target.value}),placeholder:"例: あなたは生まれながらのリーダーです！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.description,onChange:e=>n({...i,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["条件（少なくとも1つ） ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2 dark:text-gray-400",children:"これらの条件がすべて満たされた場合にこの結果が表示されます"}),i.conditions.map((e,a)=>{var s;let d;return(0,r.jsx)("div",{className:"mb-3 p-3 border rounded bg-white dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"質問"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.questionId,onChange:e=>E(a,"questionId",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),e.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"選択肢"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.selectedOption,onChange:e=>E(a,"selectedOption",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(s=e.questionId,(d=t.find(e=>e.id===s))?d.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),i.conditions.length>1&&(0,r.jsx)("button",{className:"text-red-600 text-xs hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e;return e=i.conditions.filter((e,r)=>r!==a),void n({...i,conditions:e})},children:"この条件を削除"})]})},a)}),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>{n({...i,conditions:[...i.conditions,{questionId:"",selectedOption:""}]})},children:"+ 条件を追加"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"優先度"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.priority,onChange:e=>{let r=parseInt(e.target.value,10);n({...i,priority:isNaN(r)?i.priority:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"高い方が優先してマッチします"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.order,onChange:e=>{let r=parseInt(e.target.value,10);n({...i,order:isNaN(r)?i.order:r})}})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:o,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:s?g:m,children:s?"更新":"作成"})]})]})]})]})},E=()=>({questionId:"",name:"",message:"",description:"",condition:{selectedOption:""},order:0}),f=({questionAnswers:e,questions:t,onUpdate:a})=>{var s;let d,{editing:i,isCreating:n,formData:o,setFormData:c,resetForm:x,startEdit:h,startCreate:b}=(0,j.useCRUDManager)(E),p=()=>{let e=(0,y.validateQuestionAnswerForm)(o.questionId,o.name,o.message,o.condition.selectedOption,t);return!e||(alert(e),!1)},v=async()=>{if(p())try{await u({questionId:o.questionId,name:o.name,message:o.message,description:o.description,condition:o.condition,order:o.order}),x(),a()}catch(e){(0,N.handleError)("質問回答パターンの作成に失敗しました",e,l.ERROR_MESSAGES.CREATE_QUESTION_ANSWER_FAILED)}},k=async()=>{if(i&&p())try{await m({id:i.id,questionId:o.questionId,name:o.name,message:o.message,description:o.description,condition:o.condition,order:o.order}),x(),a()}catch(e){(0,N.handleError)("質問回答パターンの更新に失敗しました",e,l.ERROR_MESSAGES.UPDATE_QUESTION_ANSWER_FAILED)}},f=async e=>{if((0,N.confirmAction)(l.CONFIRMATION_MESSAGES.DELETE_QUESTION_ANSWER))try{await g(e),a()}catch(e){(0,N.handleError)("質問回答パターンの削除に失敗しました",e,l.ERROR_MESSAGES.DELETE_QUESTION_ANSWER_FAILED)}},S=t.map(r=>({question:r,answers:e.filter(e=>e.questionId===r.id)}));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問回答パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{b({order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-6",children:0===S.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"質問がありません。"}):S.map(({question:e,answers:t})=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:e.text}),0===t.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"この質問の回答パターンはまだありません"}):(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,r.jsx)("div",{className:"border rounded p-3 bg-gray-50 dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"font-bold",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["選択肢: ",e.condition.selectedOption]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-1 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{h(e,e=>({questionId:e.questionId,name:e.name,message:e.message,description:e.description||"",condition:{...e.condition},order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>f(e.id),children:"削除"})]})]})},e.id))})]},e.id))}),(n||i)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:i?"質問回答パターンを編集":"新規質問回答パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["質問 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.questionId,onChange:e=>c({...o,questionId:e.target.value,condition:{selectedOption:""}}),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),o.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["選択肢 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.condition.selectedOption,onChange:e=>c({...o,condition:{selectedOption:e.target.value}}),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(s=o.questionId,(d=t.find(e=>e.id===s))?d.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.name,onChange:e=>c({...o,name:e.target.value}),placeholder:"例: ポジティブタイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.message,onChange:e=>c({...o,message:e.target.value}),placeholder:"例: 素晴らしい選択です！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.description,onChange:e=>c({...o,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.order,onChange:e=>{let r=parseInt(e.target.value,10);c({...o,order:isNaN(r)?o.order:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"小さい方が優先して表示されます"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:x,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:i?k:v,children:i?"更新":"作成"})]})]})]})]})};e.i(79268);var S=e.i(56867),w=e.i(56309);e.i(16787);var A=e.i(58594);e.i(14603),e.i(37904);let I=()=>({text:"",options:Array(l.UI_CONSTANTS.DEFAULT_OPTIONS_COUNT).fill(""),order:0}),T=({questions:e,onUpdate:t})=>{let{editing:a,isCreating:s,formData:d,setFormData:i,resetForm:n,startEdit:u,startCreate:m}=(0,j.useCRUDManager)(I),g=()=>d.options.filter(e=>e.trim()),h=async()=>{let e=g(),r=(0,y.validateQuestionForm)(d.text,e);if(r)return void alert(r);try{await o({text:d.text,options:e,order:d.order}),n(),t()}catch(e){(0,N.handleError)("質問の作成に失敗しました",e,l.ERROR_MESSAGES.CREATE_QUESTION_FAILED)}},b=async()=>{if(!a)return;let e=g(),r=(0,y.validateQuestionForm)(d.text,e);if(r)return void alert(r);try{await c({id:a.id,text:d.text,options:e,order:d.order}),n(),t()}catch(e){(0,N.handleError)("質問の更新に失敗しました",e,l.ERROR_MESSAGES.UPDATE_QUESTION_FAILED)}},p=async e=>{if((0,N.confirmAction)(l.CONFIRMATION_MESSAGES.DELETE_QUESTION))try{await x(e),t()}catch(e){(0,N.handleError)("質問の削除に失敗しました",e,l.ERROR_MESSAGES.DELETE_QUESTION_FAILED)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{m({order:e.length})},children:"新規質問作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,r.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400",children:e.options.map((e,t)=>(0,r.jsxs)("li",{children:["・",e]},t))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{u(e,e=>({text:e.text,options:[...e.options,""],order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>p(e.id),children:"削除"})]})]})},e.id))}),(s||a)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:a?"質問を編集":"新規質問"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:d.text,onChange:e=>i({...d,text:e.target.value}),placeholder:"質問を入力"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),d.options.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,r.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:e,onChange:e=>{let r=[...d.options];r[t]=e.target.value,i({...d,options:r})},placeholder:`選択肢 ${t+1}`}),t>=2&&(0,r.jsx)("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e=d.options.filter((e,r)=>r!==t);i({...d,options:e})},children:"削除"})]},t)),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>i({...d,options:[...d.options,""]}),children:"+ 選択肢を追加"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:d.order,onChange:e=>i({...d,order:parseInt(e.target.value)||0})})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:n,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:a?b:h,children:a?"更新":"作成"})]})]})]})]})},O=({userEmail:e,userId:t,onLogout:a})=>{let{data:n,loading:o,refresh:c}=(0,w.useAsyncData)(s.getQuestions),{data:x,loading:u,refresh:m}=(0,w.useAsyncData)(d.getResultPatterns),{data:g,loading:h,refresh:b}=(0,w.useAsyncData)(i.getQuestionAnswers);return o||u||h?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(A.Spinner,{size:"lg",label:"質問編集画面を読み込んでいます..."})}):(0,r.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,r.jsx)(S.AdminHeader,{email:e,userId:t,onLogout:a}),(0,r.jsxs)("div",{className:"mb-6 flex gap-4",children:[(0,r.jsx)("a",{href:`${l.BASE_PATH}/admin`,className:"px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",children:"← 管理画面トップ"}),(0,r.jsx)("a",{href:`${l.BASE_PATH}/admin/results`,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",children:"アンケート結果確認 →"})]}),(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsx)(T,{questions:n||[],onUpdate:c}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(f,{questionAnswers:g||[],questions:n||[],onUpdate:b})}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(k,{patterns:x||[],questions:n||[],onUpdate:m})})]})]})};var C=e.i(3380),R=e.i(48350);function _(){let{user:e,loading:s,isAdminUser:d,checking:i}=(0,t.useAdminAccess)(),n=async()=>{await (0,C.signOut)(),window.location.href=l.BASE_PATH+"/"};return s||i?(0,r.jsx)(R.LoadingScreen,{}):!e||e.isAnonymous?(0,r.jsx)(a.UnauthorizedAccess,{type:"not-logged-in",onAction:()=>{window.location.href=l.BASE_PATH+"/"}}):d?(0,r.jsx)(O,{userEmail:e.email,userId:e.uid,onLogout:n}):(0,r.jsx)(a.UnauthorizedAccess,{type:"insufficient-permissions",uid:e.uid,onAction:n})}e.s(["default",()=>_],56187)}]);