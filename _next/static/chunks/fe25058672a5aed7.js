(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16787,58594,48350,41635,e=>{"use strict";var r=e.i(43476);let t=({size:e="md",label:t="読み込み中...",className:a=""})=>(0,r.jsxs)("div",{className:`flex items-center justify-center ${a}`,role:"status",children:[(0,r.jsx)("div",{className:`${{sm:"w-4 h-4 border-2",md:"w-8 h-8 border-2",lg:"w-12 h-12 border-4"}[e]} border-blue-200 border-t-blue-600 rounded-full animate-spin dark:border-gray-600 dark:border-t-blue-400`,"aria-hidden":"true"}),(0,r.jsx)("span",{className:"sr-only",children:t})]});e.s(["Spinner",0,t],58594),e.s(["LoadingScreen",0,({message:e="読み込み中..."})=>(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(t,{size:"lg",label:e}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 animate-pulse",children:e})]})})],48350);let a={"gradient-blue":"bg-gradient-to-r from-blue-500 to-cyan-500 text-white shadow-md","gradient-purple":"bg-gradient-to-r from-purple-700 to-pink-700 text-white shadow-md","gradient-green":"bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-md",default:"bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 border-2 border-blue-200 dark:border-blue-700 shadow-lg"};e.s(["GradientCard",0,({children:e,className:t="",variant:s="default"})=>(0,r.jsx)("div",{className:`${a[s]} rounded-lg ${t}`,children:e})],41635),e.s([],16787)},72906,e=>{"use strict";var r=e.i(43476),t=e.i(56348),a=e.i(86134),s=e.i(85149);let d=async e=>(0,a.documentExists)(s.COLLECTIONS.ADMINS,e),l=e=>{let t="not-logged-in"===e.type;return(0,r.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,r.jsxs)("div",{className:`border rounded p-6 ${t?"bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-800"}`,children:[(0,r.jsx)("h2",{className:`text-xl font-bold mb-2 ${t?"text-red-800 dark:text-red-200":"text-yellow-800 dark:text-yellow-200"}`,children:t?"アクセス権限がありません":"管理者権限がありません"}),(0,r.jsx)("p",{className:`mb-4 ${t?"text-red-600 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:t?"管理者としてログインする必要があります。":(0,r.jsxs)(r.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,r.jsx)("br",{}),"UID: ",e.uid]})}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e.onAction,children:t?"ホームに戻る":"ログアウト"})]})})};var i=e.i(79472),n=e.i(25026),o=e.i(80368);let c=async e=>(0,a.createDocument)(s.COLLECTIONS.QUESTIONS,e),x=async e=>{let{id:r,...t}=e;await (0,a.updateDocument)(s.COLLECTIONS.QUESTIONS,r,t)},m=async e=>{await (0,a.deleteDocument)(s.COLLECTIONS.QUESTIONS,e)},b=async e=>(0,a.createDocument)(s.COLLECTIONS.QUESTION_ANSWERS,e),g=async e=>{let{id:r,...t}=e;await (0,a.updateDocument)(s.COLLECTIONS.QUESTION_ANSWERS,r,t)},h=async e=>{await (0,a.deleteDocument)(s.COLLECTIONS.QUESTION_ANSWERS,e)},u=async e=>(0,a.createDocument)(s.COLLECTIONS.RESULT_PATTERNS,e),p=async e=>{let{id:r,...t}=e;await (0,a.updateDocument)(s.COLLECTIONS.RESULT_PATTERNS,r,t)},y=async e=>{await (0,a.deleteDocument)(s.COLLECTIONS.RESULT_PATTERNS,e)},j=({email:e,userId:t,onLogout:a})=>(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e||t})]}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:a,children:"ログアウト"})]});e.i(32832);var N=e.i(36841),k=e.i(72585),v=e.i(52928);let f=()=>({questionId:"",name:"",message:"",description:"",condition:{selectedOption:""},order:0}),E=({questionAnswers:e,questions:t,onUpdate:a})=>{var d;let l,{editing:i,isCreating:n,formData:o,setFormData:c,resetForm:x,startEdit:m,startCreate:u}=(0,v.useCRUDManager)(f),p=()=>{let e=(0,N.validateQuestionAnswerForm)(o.questionId,o.name,o.message,o.condition.selectedOption,t);return!e||(alert(e),!1)},y=async()=>{if(p())try{await b({questionId:o.questionId,name:o.name,message:o.message,description:o.description,condition:o.condition,order:o.order}),x(),a()}catch(e){(0,k.handleError)("質問回答パターンの作成に失敗しました",e,s.ERROR_MESSAGES.CREATE_QUESTION_ANSWER_FAILED)}},j=async()=>{if(i&&p())try{await g({id:i.id,questionId:o.questionId,name:o.name,message:o.message,description:o.description,condition:o.condition,order:o.order}),x(),a()}catch(e){(0,k.handleError)("質問回答パターンの更新に失敗しました",e,s.ERROR_MESSAGES.UPDATE_QUESTION_ANSWER_FAILED)}},E=async e=>{if((0,k.confirmAction)(s.CONFIRMATION_MESSAGES.DELETE_QUESTION_ANSWER))try{await h(e),a()}catch(e){(0,k.handleError)("質問回答パターンの削除に失敗しました",e,s.ERROR_MESSAGES.DELETE_QUESTION_ANSWER_FAILED)}},w=t.map(r=>({question:r,answers:e.filter(e=>e.questionId===r.id)}));return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問回答パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{u({order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-6",children:0===w.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"質問がありません。"}):w.map(({question:e,answers:t})=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:e.text}),0===t.length?(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"この質問の回答パターンはまだありません"}):(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,r.jsx)("div",{className:"border rounded p-3 bg-gray-50 dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("span",{className:"font-bold",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["選択肢: ",e.condition.selectedOption]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-1 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{m(e,e=>({questionId:e.questionId,name:e.name,message:e.message,description:e.description||"",condition:{...e.condition},order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>E(e.id),children:"削除"})]})]})},e.id))})]},e.id))}),(n||i)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:i?"質問回答パターンを編集":"新規質問回答パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["質問 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.questionId,onChange:e=>c({...o,questionId:e.target.value,condition:{selectedOption:""}}),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),o.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["選択肢 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.condition.selectedOption,onChange:e=>c({...o,condition:{selectedOption:e.target.value}}),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(d=o.questionId,(l=t.find(e=>e.id===d))?l.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.name,onChange:e=>c({...o,name:e.target.value}),placeholder:"例: ポジティブタイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.message,onChange:e=>c({...o,message:e.target.value}),placeholder:"例: 素晴らしい選択です！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.description,onChange:e=>c({...o,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.order,onChange:e=>{let r=parseInt(e.target.value,10);c({...o,order:isNaN(r)?o.order:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"小さい方が優先して表示されます"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:x,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:i?j:y,children:i?"更新":"作成"})]})]})]})]})},w=()=>({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:0}),S=({patterns:e,questions:t,onUpdate:a})=>{let{editing:d,isCreating:l,formData:i,setFormData:n,resetForm:o,startEdit:c,startCreate:x}=(0,v.useCRUDManager)(w),m=()=>{let e=(0,N.validateResultPatternForm)(i.name,i.message,i.conditions.length);if(e)return alert(e),null;let r=i.conditions.filter(e=>{if(!e.questionId||!e.selectedOption.trim())return!1;let r=t.find(r=>r.id===e.questionId);return!!r&&!!r.options.includes(e.selectedOption)});if(0===r.length)return alert("少なくとも1つの有効な条件を設定してください"),null;let a=i.conditions.length-r.length;return a>0&&alert(`${a}件の無効な条件が除外されました。削除された質問や選択肢を参照している条件は保存できません。`),r},b=async()=>{let e=m();if(e)try{await u({name:i.name,message:i.message,description:i.description,conditions:e,priority:i.priority,order:i.order}),o(),a()}catch(e){(0,k.handleError)("結果パターンの作成に失敗しました",e,s.ERROR_MESSAGES.CREATE_RESULT_PATTERN_FAILED)}},g=async()=>{if(!d)return;let e=m();if(e)try{await p({id:d.id,name:i.name,message:i.message,description:i.description,conditions:e,priority:i.priority,order:i.order}),o(),a()}catch(e){(0,k.handleError)("結果パターンの更新に失敗しました",e,s.ERROR_MESSAGES.UPDATE_RESULT_PATTERN_FAILED)}},h=async e=>{if((0,k.confirmAction)(s.CONFIRMATION_MESSAGES.DELETE_RESULT_PATTERN))try{await y(e),a()}catch(e){(0,k.handleError)("結果パターンの削除に失敗しました",e,s.ERROR_MESSAGES.DELETE_RESULT_PATTERN_FAILED)}},j=(e,r,t)=>{let a=[...i.conditions];a[e]={...a[e],[r]:t},n({...i,conditions:a})};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"結果パターン管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{x({conditions:[{questionId:"",selectedOption:""}],priority:10,order:e.length})},children:"新規パターン作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:0===e.length?(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"結果パターンがありません。新規作成してください。"}):e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"font-bold text-lg",children:e.name}),(0,r.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["優先度: ",e.priority]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2 dark:text-gray-300",children:e.message}),e.description&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-2 dark:text-gray-400",children:e.description}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[(0,r.jsx)("p",{className:"font-semibold mb-1",children:"条件:"}),(0,r.jsx)("ul",{className:"ml-4 space-y-1",children:e.conditions.map((e,a)=>{var s;let d;return(0,r.jsxs)("li",{children:["・",(s=e.questionId,(d=t.find(e=>e.id===s))?d.text:s?`削除された質問 (ID: ${s})`:"")," → 「",e.selectedOption,"」"]},a)})})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{c(e,e=>({name:e.name,message:e.message,description:e.description||"",conditions:[...e.conditions],priority:e.priority,order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>h(e.id),children:"削除"})]})]})},e.id))}),(l||d)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:d?"結果パターンを編集":"新規結果パターン"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.name,onChange:e=>n({...i,name:e.target.value}),placeholder:"例: リーダータイプ"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.message,onChange:e=>n({...i,message:e.target.value}),placeholder:"例: あなたは生まれながらのリーダーです！",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,r.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.description,onChange:e=>n({...i,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["条件（少なくとも1つ） ",(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2 dark:text-gray-400",children:"これらの条件がすべて満たされた場合にこの結果が表示されます"}),i.conditions.map((e,a)=>{var s;let d;return(0,r.jsx)("div",{className:"mb-3 p-3 border rounded bg-white dark:bg-gray-700 dark:border-gray-600",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"質問"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.questionId,onChange:e=>j(a,"questionId",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 質問を選択 --"}),t.map(e=>(0,r.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),e.questionId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium mb-1",children:"選択肢"}),(0,r.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.selectedOption,onChange:e=>j(a,"selectedOption",e.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(s=e.questionId,(d=t.find(e=>e.id===s))?d.options:[]).map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),i.conditions.length>1&&(0,r.jsx)("button",{className:"text-red-600 text-xs hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e;return e=i.conditions.filter((e,r)=>r!==a),void n({...i,conditions:e})},children:"この条件を削除"})]})},a)}),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>{n({...i,conditions:[...i.conditions,{questionId:"",selectedOption:""}]})},children:"+ 条件を追加"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"優先度"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.priority,onChange:e=>{let r=parseInt(e.target.value,10);n({...i,priority:isNaN(r)?i.priority:r})}}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"高い方が優先してマッチします"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:i.order,onChange:e=>{let r=parseInt(e.target.value,10);n({...i,order:isNaN(r)?i.order:r})}})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:o,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:d?g:b,children:d?"更新":"作成"})]})]})]})]})},I=()=>({text:"",options:Array(s.UI_CONSTANTS.DEFAULT_OPTIONS_COUNT).fill(""),order:0}),C=({questions:e,onUpdate:t})=>{let{editing:a,isCreating:d,formData:l,setFormData:i,resetForm:n,startEdit:o,startCreate:b}=(0,v.useCRUDManager)(I),g=()=>l.options.filter(e=>e.trim()),h=async()=>{let e=g(),r=(0,N.validateQuestionForm)(l.text,e);if(r)return void alert(r);try{await c({text:l.text,options:e,order:l.order}),n(),t()}catch(e){(0,k.handleError)("質問の作成に失敗しました",e,s.ERROR_MESSAGES.CREATE_QUESTION_FAILED)}},u=async()=>{if(!a)return;let e=g(),r=(0,N.validateQuestionForm)(l.text,e);if(r)return void alert(r);try{await x({id:a.id,text:l.text,options:e,order:l.order}),n(),t()}catch(e){(0,k.handleError)("質問の更新に失敗しました",e,s.ERROR_MESSAGES.UPDATE_QUESTION_FAILED)}},p=async e=>{if((0,k.confirmAction)(s.CONFIRMATION_MESSAGES.DELETE_QUESTION))try{await m(e),t()}catch(e){(0,k.handleError)("質問の削除に失敗しました",e,s.ERROR_MESSAGES.DELETE_QUESTION_FAILED)}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{b({order:e.length})},children:"新規質問作成"})]}),(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,r.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400",children:e.options.map((e,t)=>(0,r.jsxs)("li",{children:["・",e]},t))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{o(e,e=>({text:e.text,options:[...e.options,""],order:e.order}))},children:"編集"}),(0,r.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>p(e.id),children:"削除"})]})]})},e.id))}),(d||a)&&(0,r.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-4",children:a?"質問を編集":"新規質問"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,r.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:l.text,onChange:e=>i({...l,text:e.target.value}),placeholder:"質問を入力"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),l.options.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,r.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:e,onChange:e=>{let r=[...l.options];r[t]=e.target.value,i({...l,options:r})},placeholder:`選択肢 ${t+1}`}),t>=2&&(0,r.jsx)("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e=l.options.filter((e,r)=>r!==t);i({...l,options:e})},children:"削除"})]},t)),(0,r.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>i({...l,options:[...l.options,""]}),children:"+ 選択肢を追加"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,r.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:l.order,onChange:e=>i({...l,order:parseInt(e.target.value)||0})})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:n,children:"キャンセル"}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:a?u:h,children:a?"更新":"作成"})]})]})]})]})};var O=e.i(79268),T=e.i(56309);e.i(16787);var A=e.i(58594);let R=({userEmail:e,userId:t,onLogout:a})=>{let{data:s,loading:d,refresh:l}=(0,T.useAsyncData)(()=>(0,i.getQuestions)()),{data:c,loading:x,refresh:m}=(0,T.useAsyncData)(()=>(0,n.getResultPatterns)()),{data:b,loading:g,refresh:h}=(0,T.useAsyncData)(()=>(0,o.getQuestionAnswers)());return d||x||g?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(A.Spinner,{size:"lg",label:"管理画面を読み込んでいます..."})}):(0,r.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,r.jsx)(j,{email:e,userId:t,onLogout:a}),(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsx)(C,{questions:s||[],onUpdate:l}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(E,{questionAnswers:b||[],questions:s||[],onUpdate:h})}),(0,r.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,r.jsx)(S,{patterns:c||[],questions:s||[],onUpdate:m})}),(0,r.jsxs)("div",{className:"border-t pt-6 dark:border-gray-700",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,r.jsx)(O.ResultList,{questions:s||[]})]})]})]})};e.i(51718);var _=e.i(18357),L=e.i(59141);let D=async()=>{await (0,_.signOut)(L.auth)};var U=e.i(48350),q=e.i(71645);function M(){let{user:e,loading:a}=(0,t.useAuth)(),[s,i]=(0,q.useState)(!1),[n,o]=(0,q.useState)(!0);(0,q.useEffect)(()=>{let r=async()=>{e&&i(await d(e.uid)),o(!1)};a||r()},[e,a]);let c=async()=>{await D(),window.location.href="/"};return a||n?(0,r.jsx)(U.LoadingScreen,{}):!e||e.isAnonymous?(0,r.jsx)(l,{type:"not-logged-in",onAction:()=>{window.location.href="/"}}):s?(0,r.jsx)(R,{userEmail:e.email,userId:e.uid,onLogout:c}):(0,r.jsx)(l,{type:"insufficient-permissions",uid:e.uid,onAction:c})}e.s(["default",()=>M],72906)}]);