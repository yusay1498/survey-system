(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72906,e=>{"use strict";var t=e.i(43476),r=e.i(56348);e.i(36180);var s=e.i(98925),a=e.i(59141);let d=async e=>{let t=(0,s.doc)(a.firestore,"admins",e);return(await (0,s.getDoc)(t)).exists()},i=e=>{let r="not-logged-in"===e.type;return(0,t.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,t.jsxs)("div",{className:`border rounded p-6 ${r?"bg-red-50 dark:bg-red-900 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900 border-yellow-200 dark:border-yellow-800"}`,children:[(0,t.jsx)("h2",{className:`text-xl font-bold mb-2 ${r?"text-red-800 dark:text-red-200":"text-yellow-800 dark:text-yellow-200"}`,children:r?"アクセス権限がありません":"管理者権限がありません"}),(0,t.jsx)("p",{className:`mb-4 ${r?"text-red-600 dark:text-red-300":"text-yellow-700 dark:text-yellow-300"}`,children:r?"管理者としてログインする必要があります。":(0,t.jsxs)(t.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,t.jsx)("br",{}),"UID: ",e.uid]})}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:e.onAction,children:r?"ホームに戻る":"ログアウト"})]})})};var l=e.i(71645),o=e.i(79472),n=e.i(25026);let c=async e=>(await (0,s.addDoc)((0,s.collection)(a.firestore,"questions"),{text:e.text,options:e.options,order:e.order,createdAt:(0,s.serverTimestamp)()})).id,x=async e=>{let t=(0,s.doc)(a.firestore,"questions",e.id);await (0,s.updateDoc)(t,{text:e.text,options:e.options,order:e.order})},m=async e=>{let t=(0,s.doc)(a.firestore,"questions",e);await (0,s.deleteDoc)(t)},u=({questions:e,onUpdate:r})=>{let[s,a]=(0,l.useState)(null),[d,i]=(0,l.useState)(!1),[o,n]=(0,l.useState)({text:"",options:["","",""],order:0}),u=()=>{n({text:"",options:["","",""],order:0}),a(null),i(!1)},b=async()=>{let e=o.options.filter(e=>e.trim());if(!o.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await c({text:o.text,options:e,order:o.order}),u(),r()}catch(e){console.error("質問の作成に失敗しました:",e),alert("質問の作成に失敗しました。もう一度お試しください。")}},g=async()=>{let e=o.options.filter(e=>e.trim());if(s){if(!o.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await x({id:s.id,text:o.text,options:e,order:o.order}),u(),r()}catch(e){console.error("質問の更新に失敗しました:",e),alert("質問の更新に失敗しました。もう一度お試しください。")}}},h=async e=>{if(confirm("この質問を削除しますか？"))try{await m(e),r()}catch(e){console.error("質問の削除に失敗しました:",e),alert("質問の削除に失敗しました。もう一度お試しください。")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,t.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{i(!0),a(null),n({text:"",options:["","",""],order:e.length})},children:"新規質問作成"})]}),(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,t.jsx)("ul",{className:"ml-4 text-sm text-gray-600 dark:text-gray-400",children:e.options.map((e,r)=>(0,t.jsxs)("li",{children:["・",e]},r))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{a(e),n({text:e.text,options:[...e.options,""],order:e.order}),i(!1)},children:"編集"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>h(e.id),children:"削除"})]})]})},e.id))}),(d||s)&&(0,t.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:s?"質問を編集":"新規質問"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.text,onChange:e=>n({...o,text:e.target.value}),placeholder:"質問を入力"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),o.options.map((e,r)=>(0,t.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,t.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:e,onChange:e=>{let t=[...o.options];t[r]=e.target.value,n({...o,options:t})},placeholder:`選択肢 ${r+1}`}),r>=2&&(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e=o.options.filter((e,t)=>t!==r);n({...o,options:e})},children:"削除"})]},r)),(0,t.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>n({...o,options:[...o.options,""]}),children:"+ 選択肢を追加"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:o.order,onChange:e=>n({...o,order:parseInt(e.target.value)||0})})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:u,children:"キャンセル"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:s?g:b,children:s?"更新":"作成"})]})]})]})]})},b=async e=>(await (0,s.addDoc)((0,s.collection)(a.firestore,"resultPatterns"),{name:e.name,message:e.message,description:e.description,conditions:e.conditions,priority:e.priority,order:e.order,createdAt:(0,s.serverTimestamp)()})).id,g=async e=>{let t=(0,s.doc)(a.firestore,"resultPatterns",e.id);await (0,s.updateDoc)(t,{name:e.name,message:e.message,description:e.description,conditions:e.conditions,priority:e.priority,order:e.order})},h=async e=>{let t=(0,s.doc)(a.firestore,"resultPatterns",e);await (0,s.deleteDoc)(t)},p=({patterns:e,questions:r,onUpdate:s})=>{let[a,d]=(0,l.useState)(null),[i,o]=(0,l.useState)(!1),[n,c]=(0,l.useState)({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:0}),x=()=>{c({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:0}),d(null),o(!1)},m=()=>{if(!n.name.trim())return alert("結果パターン名を入力してください"),null;if(!n.message.trim())return alert("メッセージを入力してください"),null;let e=n.conditions.filter(e=>{if(!e.questionId||!e.selectedOption.trim())return!1;let t=r.find(t=>t.id===e.questionId);return!!t&&!!t.options.includes(e.selectedOption)});if(0===e.length)return alert("少なくとも1つの有効な条件を設定してください"),null;let t=n.conditions.length-e.length;return t>0&&alert(`${t}件の無効な条件が除外されました。削除された質問や選択肢を参照している条件は保存できません。`),e},u=async()=>{let e=m();if(e)try{await b({name:n.name,message:n.message,description:n.description,conditions:e,priority:n.priority,order:n.order}),x(),s()}catch(e){console.error("結果パターンの作成に失敗しました:",e),alert("結果パターンの作成に失敗しました。もう一度お試しください。")}},p=async()=>{if(!a)return;let e=m();if(e)try{await g({id:a.id,name:n.name,message:n.message,description:n.description,conditions:e,priority:n.priority,order:n.order}),x(),s()}catch(e){console.error("結果パターンの更新に失敗しました:",e),alert("結果パターンの更新に失敗しました。もう一度お試しください。")}},y=async e=>{if(confirm("この結果パターンを削除しますか？"))try{await h(e),s()}catch(e){console.error("結果パターンの削除に失敗しました:",e),alert("結果パターンの削除に失敗しました。もう一度お試しください。")}},j=(e,t,r)=>{let s=[...n.conditions];s[e]={...s[e],[t]:r},c({...n,conditions:s})};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"結果パターン管理"}),(0,t.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>{o(!0),d(null),c({name:"",message:"",description:"",conditions:[{questionId:"",selectedOption:""}],priority:10,order:e.length})},children:"新規パターン作成"})]}),(0,t.jsx)("div",{className:"space-y-4",children:0===e.length?(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"結果パターンがありません。新規作成してください。"}):e.map(e=>(0,t.jsx)("div",{className:"border rounded p-4 bg-white shadow dark:bg-gray-800 dark:border-gray-700",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("span",{className:"font-bold text-lg",children:e.name}),(0,t.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-200",children:["優先度: ",e.priority]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-700 mb-2 dark:text-gray-300",children:e.message}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-2 dark:text-gray-400",children:e.description}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[(0,t.jsx)("p",{className:"font-semibold mb-1",children:"条件:"}),(0,t.jsx)("ul",{className:"ml-4 space-y-1",children:e.conditions.map((e,s)=>{var a;let d;return(0,t.jsxs)("li",{children:["・",(a=e.questionId,(d=r.find(e=>e.id===a))?d.text:a?`削除された質問 (ID: ${a})`:"")," → 「",e.selectedOption,"」"]},s)})})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:()=>{d(e),c({name:e.name,message:e.message,description:e.description||"",conditions:[...e.conditions],priority:e.priority,order:e.order}),o(!1)},children:"編集"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:()=>y(e.id),children:"削除"})]})]})},e.id))}),(i||a)&&(0,t.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg dark:bg-gray-800 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:a?"結果パターンを編集":"新規結果パターン"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["パターン名 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:n.name,onChange:e=>c({...n,name:e.target.value}),placeholder:"例: リーダータイプ"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:n.message,onChange:e=>c({...n,message:e.target.value}),placeholder:"例: あなたは生まれながらのリーダーです！",rows:3})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"詳細説明（オプション）"}),(0,t.jsx)("textarea",{className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:n.description,onChange:e=>c({...n,description:e.target.value}),placeholder:"追加の説明文",rows:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["条件（少なくとも1つ） ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-2 dark:text-gray-400",children:"これらの条件がすべて満たされた場合にこの結果が表示されます"}),n.conditions.map((e,s)=>{var a;let d;return(0,t.jsx)("div",{className:"mb-3 p-3 border rounded bg-white dark:bg-gray-700 dark:border-gray-600",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1",children:"質問"}),(0,t.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.questionId,onChange:e=>j(s,"questionId",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"-- 質問を選択 --"}),r.map(e=>(0,t.jsx)("option",{value:e.id,children:e.text},e.id))]})]}),e.questionId&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs font-medium mb-1",children:"選択肢"}),(0,t.jsxs)("select",{className:"w-full border rounded px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-600 dark:text-white",value:e.selectedOption,onChange:e=>j(s,"selectedOption",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"-- 選択肢を選択 --"}),(a=e.questionId,(d=r.find(e=>e.id===a))?d.options:[]).map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),n.conditions.length>1&&(0,t.jsx)("button",{className:"text-red-600 text-xs hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",onClick:()=>{let e;return e=n.conditions.filter((e,t)=>t!==s),void c({...n,conditions:e})},children:"この条件を削除"})]})},s)}),(0,t.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>{c({...n,conditions:[...n.conditions,{questionId:"",selectedOption:""}]})},children:"+ 条件を追加"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"優先度"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:n.priority,onChange:e=>{let t=parseInt(e.target.value,10);c({...n,priority:isNaN(t)?n.priority:t})}}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"高い方が優先してマッチします"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:n.order,onChange:e=>{let t=parseInt(e.target.value,10);c({...n,order:isNaN(t)?n.order:t})}})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 dark:bg-gray-600 dark:hover:bg-gray-700",onClick:x,children:"キャンセル"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:a?p:u,children:a?"更新":"作成"})]})]})]})]})};var y=e.i(79268);let j=({email:e,uid:r,onLogout:s})=>(0,t.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e||r})]}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:s,children:"ログアウト"})]}),k=({userEmail:e,userId:r,onLogout:s})=>{let[a,d]=(0,l.useState)([]),[i,c]=(0,l.useState)(!1),[x,m]=(0,l.useState)([]),[b,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{i||(0,o.getQuestions)().then(e=>{d(e),c(!0)}).catch(e=>{console.error("Failed to load questions:",e),c(!0)})},[i]),(0,l.useEffect)(()=>{b||(0,n.getResultPatterns)().then(e=>{m(e),g(!0)}).catch(e=>{console.error("Failed to load result patterns:",e),g(!0)})},[b]);let h=async()=>{d(await (0,o.getQuestions)())},k=async()=>{m(await (0,n.getResultPatterns)())};return(0,t.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,t.jsx)(j,{email:e,uid:r,onLogout:s}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(u,{questions:a,onUpdate:h}),(0,t.jsx)("div",{className:"border-t pt-6 dark:border-gray-700",children:(0,t.jsx)(p,{patterns:x,questions:a,onUpdate:k})}),(0,t.jsxs)("div",{className:"border-t pt-6 dark:border-gray-700",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,t.jsx)(y.ResultList,{questions:a})]})]})]})};e.i(51718);var v=e.i(18357);let N=async()=>{await (0,v.signOut)(a.firebaseAuth)};function f(){let{user:e,loading:s}=(0,r.useAuth)(),[a,o]=(0,l.useState)(!1),[n,c]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let t=async()=>{e&&o(await d(e.uid)),c(!1)};s||t()},[e,s]);let x=async()=>{await N(),window.location.href="/"};return s||n?(0,t.jsx)("p",{className:"p-6",children:"Loading..."}):!e||e.isAnonymous?(0,t.jsx)(i,{type:"not-logged-in",onAction:()=>{window.location.href="/"}}):a?(0,t.jsx)(k,{userEmail:e.email,userId:e.uid,onLogout:x}):(0,t.jsx)(i,{type:"insufficient-permissions",uid:e.uid,onAction:x})}e.s(["default",()=>f],72906)}]);