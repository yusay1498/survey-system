(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72906,e=>{"use strict";var t=e.i(43476),s=e.i(56348);e.i(36180);var r=e.i(98925),l=e.i(59141);let i=async e=>{let t=(0,r.doc)(l.firestore,"admins",e);return(await (0,r.getDoc)(t)).exists()},o=e=>{let s="not-logged-in"===e.type;return(0,t.jsx)("div",{className:"p-6 max-w-2xl mx-auto",children:(0,t.jsxs)("div",{className:`border rounded p-6 ${s?"bg-red-50":"bg-yellow-50"}`,children:[(0,t.jsx)("h2",{className:`text-xl font-bold mb-2 ${s?"text-red-800":"text-yellow-800"}`,children:s?"アクセス権限がありません":"管理者権限がありません"}),(0,t.jsx)("p",{className:`mb-4 ${s?"text-red-600":"text-yellow-700"}`,children:s?"管理者としてログインする必要があります。":(0,t.jsxs)(t.Fragment,{children:["このアカウントには管理者権限が付与されていません。",(0,t.jsx)("br",{}),"UID: ",e.uid]})}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:e.onAction,children:s?"ホームに戻る":"ログアウト"})]})})};var a=e.i(71645),n=e.i(79472);let d=async e=>(await (0,r.addDoc)((0,r.collection)(l.firestore,"questions"),{text:e.text,options:e.options,order:e.order,createdAt:(0,r.serverTimestamp)()})).id,c=async e=>{let t=(0,r.doc)(l.firestore,"questions",e.id);await (0,r.updateDoc)(t,{text:e.text,options:e.options,order:e.order})},x=async e=>{let t=(0,r.doc)(l.firestore,"questions",e);await (0,r.deleteDoc)(t)},u=({questions:e,onUpdate:s})=>{let[r,l]=(0,a.useState)(null),[i,o]=(0,a.useState)(!1),[n,u]=(0,a.useState)({text:"",options:["","",""],order:0}),m=()=>{u({text:"",options:["","",""],order:0}),l(null),o(!1)},h=async()=>{let e=n.options.filter(e=>e.trim());if(!n.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await d({text:n.text,options:e,order:n.order}),m(),s()}catch(e){console.error("質問の作成に失敗しました:",e),alert("質問の作成に失敗しました。もう一度お試しください。")}},p=async()=>{let e=n.options.filter(e=>e.trim());if(r){if(!n.text.trim())return void alert("質問文を入力してください");if(e.length<2)return void alert("選択肢を2つ以上入力してください");try{await c({id:r.id,text:n.text,options:e,order:n.order}),m(),s()}catch(e){console.error("質問の更新に失敗しました:",e),alert("質問の更新に失敗しました。もう一度お試しください。")}}},b=async e=>{if(confirm("この質問を削除しますか？"))try{await x(e),s()}catch(e){console.error("質問の削除に失敗しました:",e),alert("質問の削除に失敗しました。もう一度お試しください。")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"質問管理"}),(0,t.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",onClick:()=>{o(!0),l(null),u({text:"",options:["","",""],order:e.length})},children:"新規質問作成"})]}),(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsx)("div",{className:"border rounded p-4 bg-white shadow",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:e.text}),(0,t.jsx)("ul",{className:"ml-4 text-sm text-gray-600",children:e.options.map((e,s)=>(0,t.jsxs)("li",{children:["・",e]},s))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",onClick:()=>{l(e),u({text:e.text,options:[...e.options,""],order:e.order}),o(!1)},children:"編集"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",onClick:()=>b(e.id),children:"削除"})]})]})},e.id))}),(i||r)&&(0,t.jsxs)("div",{className:"border rounded p-6 bg-gray-50 shadow-lg",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:r?"質問を編集":"新規質問"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"質問文"}),(0,t.jsx)("input",{type:"text",className:"w-full border rounded px-3 py-2",value:n.text,onChange:e=>u({...n,text:e.target.value}),placeholder:"質問を入力"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"選択肢（最低2つ）"}),n.options.map((e,s)=>(0,t.jsxs)("div",{className:"mb-2 flex gap-2",children:[(0,t.jsx)("input",{type:"text",className:"flex-1 border rounded px-3 py-2",value:e,onChange:e=>{let t=[...n.options];t[s]=e.target.value,u({...n,options:t})},placeholder:`選択肢 ${s+1}`}),s>=2&&(0,t.jsx)("button",{className:"text-red-600 hover:text-red-800",onClick:()=>{let e=n.options.filter((e,t)=>t!==s);u({...n,options:e})},children:"削除"})]},s)),(0,t.jsx)("button",{className:"text-blue-600 text-sm hover:text-blue-800",onClick:()=>u({...n,options:[...n.options,""]}),children:"+ 選択肢を追加"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"表示順序"}),(0,t.jsx)("input",{type:"number",className:"w-full border rounded px-3 py-2",value:n.order,onChange:e=>u({...n,order:parseInt(e.target.value)||0})})]}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",onClick:m,children:"キャンセル"}),(0,t.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:r?p:h,children:r?"更新":"作成"})]})]})]})]})};var m=e.i(79268);let h=({email:e,uid:s,onLogout:r})=>(0,t.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"管理者画面"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e||s})]}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",onClick:r,children:"ログアウト"})]}),p=({userEmail:e,userId:s,onLogout:r})=>{let[l,i]=(0,a.useState)([]),[o,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o||(0,n.getQuestions)().then(e=>{i(e),d(!0)}).catch(e=>{console.error("Failed to load questions:",e),d(!0)})},[o]);let c=async()=>{i(await (0,n.getQuestions)())};return(0,t.jsxs)("main",{className:"p-6 max-w-6xl mx-auto",children:[(0,t.jsx)(h,{email:e,uid:s,onLogout:r}),(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsx)(u,{questions:l,onUpdate:c}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"回答結果"}),(0,t.jsx)(m.ResultList,{questions:l})]})]})]})};e.i(51718);var b=e.i(18357);let j=async()=>{await (0,b.signOut)(l.firebaseAuth)};function g(){let{user:e,loading:r}=(0,s.useAuth)(),[l,n]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let t=async()=>{e&&n(await i(e.uid)),c(!1)};r||t()},[e,r]);let x=async()=>{await j(),window.location.href="/"};return r||d?(0,t.jsx)("p",{className:"p-6",children:"Loading..."}):!e||e.isAnonymous?(0,t.jsx)(o,{type:"not-logged-in",onAction:()=>{window.location.href="/"}}):l?(0,t.jsx)(p,{userEmail:e.email,userId:e.uid,onLogout:x}):(0,t.jsx)(o,{type:"insufficient-permissions",uid:e.uid,onAction:x})}e.s(["default",()=>g],72906)}]);