# 結果パターン編集機能テストガイド

## 概要
このガイドでは、新しく追加された結果パターン編集機能をテストする方法を説明します。

## 前提条件
1. Firebase プロジェクトが設定されている
2. 環境変数が正しく設定されている（.env.local）:
   ```
   NEXT_PUBLIC_FIREBASE_API_KEY=xxx
   NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=xxx
   NEXT_PUBLIC_FIREBASE_PROJECT_ID=xxx
   NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=xxx
   NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=xxx
   NEXT_PUBLIC_FIREBASE_APP_ID=xxx
   ```
3. 管理者アカウントが作成されている

## テスト手順

### 1. 開発サーバーの起動
```bash
npm install
npm run dev
```

ブラウザで http://localhost:3000/admin にアクセス

### 2. 管理者としてログイン
- メールアドレスとパスワードでログイン
- 管理者ダッシュボードが表示されることを確認

### 3. 質問の確認/作成
結果パターンを作成する前に、質問が必要です:
1. 「質問管理」セクションを確認
2. 質問がない場合は「新規質問作成」で質問を作成
3. 例：
   - 質問文: 「あなたは朝型？夜型？」
   - 選択肢: 「朝型」「夜型」

### 4. 結果パターンの作成テスト
1. 「結果パターン管理」セクションまでスクロール
2. 「新規パターン作成」ボタンをクリック
3. 以下の情報を入力:
   - パターン名: 「朝型タイプ」
   - メッセージ: 「あなたは活動的な朝型タイプです！」
   - 詳細説明: 「早起きが得意で朝に最も集中できます。」
   - 条件:
     - 質問を選択: 「あなたは朝型？夜型？」
     - 選択肢を選択: 「朝型」
   - 優先度: 10
4. 「作成」ボタンをクリック
5. パターンが一覧に表示されることを確認

### 5. 結果パターンの表示確認
結果パターンが一覧に表示されることを確認:
- パターン名が表示されている
- メッセージが表示されている
- 詳細説明が表示されている
- 条件が読みやすい形式で表示されている
- 優先度バッジが表示されている

### 6. 結果パターンの編集テスト
1. 作成したパターンの「編集」ボタンをクリック
2. 編集フォームが開くことを確認
3. 以下を変更:
   - メッセージ: 「あなたは非常に活動的な朝型タイプです！」
   - 新しい条件を追加（「+ 条件を追加」ボタン）
4. 「更新」ボタンをクリック
5. 変更が反映されることを確認

### 7. 条件の管理テスト
1. パターンを編集モードで開く
2. 「+ 条件を追加」ボタンをクリック
3. 新しい条件入力フィールドが表示されることを確認
4. 質問と選択肢を選択
5. 「この条件を削除」ボタンで条件を削除できることを確認

### 8. バリデーションテスト
以下のケースでエラーメッセージが表示されることを確認:
1. パターン名が空のまま作成を試みる
   - 期待: 「結果パターン名を入力してください」
2. メッセージが空のまま作成を試みる
   - 期待: 「メッセージを入力してください」
3. 条件が設定されていない状態で作成を試みる
   - 期待: 「少なくとも1つの条件を設定してください」

### 9. 結果パターンの削除テスト
1. パターンの「削除」ボタンをクリック
2. 確認ダイアログが表示されることを確認
3. 「OK」をクリック
4. パターンが削除されることを確認

### 10. アンケートでの動作確認
1. トップページに戻る（/）
2. 「アンケートに回答する」をクリック
3. アンケートに回答（作成した結果パターンの条件に合う選択肢を選ぶ）
4. すべての質問に回答後、結果画面を確認
5. 作成した結果パターンのメッセージが表示されることを確認

### 11. 複数パターンの優先度テスト
1. 同じ条件で優先度が異なる2つのパターンを作成
   - パターンA: 優先度 15
   - パターンB: 優先度 10
2. アンケートに回答
3. 優先度が高いパターン（A）が表示されることを確認

## 期待される動作

### 正常系
- ✅ パターンの作成が成功する
- ✅ パターンの一覧が表示される
- ✅ パターンの編集が成功する
- ✅ パターンの削除が成功する
- ✅ 条件の追加/削除が動作する
- ✅ アンケートで正しいパターンが表示される
- ✅ 優先度順にマッチングされる

### 異常系
- ✅ バリデーションエラーが適切に表示される
- ✅ 空の条件は保存時に無視される
- ✅ Firebase エラーが発生した場合、ユーザーフレンドリーなエラーメッセージが表示される

## トラブルシューティング

### パターンが表示されない
- Firestore の `resultPatterns` コレクションを確認
- ブラウザのコンソールでエラーを確認
- Firebase インデックスが作成されているか確認

### 編集が保存されない
- ブラウザのコンソールでエラーを確認
- Firebase の権限設定を確認
- ネットワークタブでリクエストが送信されているか確認

### アンケートでパターンが表示されない
- 条件が正確に一致しているか確認
- questionId が正しいか確認（Firestore で確認）
- selectedOption のテキストが完全一致しているか確認（大文字小文字、スペース等）

## 性能テスト

### 大量のパターンを作成
1. 10個以上の結果パターンを作成
2. 一覧の読み込み速度を確認
3. 編集フォームの動作を確認

### 複雑な条件
1. 3つ以上の条件を持つパターンを作成
2. すべての条件が正しく表示されることを確認
3. 編集時に条件が正しく読み込まれることを確認

## チェックリスト

- [ ] パターンの作成が動作する
- [ ] パターンの編集が動作する
- [ ] パターンの削除が動作する
- [ ] 条件の追加が動作する
- [ ] 条件の削除が動作する
- [ ] バリデーションが動作する
- [ ] アンケートでパターンが表示される
- [ ] 優先度の高いパターンが優先される
- [ ] 複数の条件が正しく動作する
- [ ] UI/UXが直感的で使いやすい
- [ ] ダークモードで正しく表示される
- [ ] エラーハンドリングが適切

## スクリーンショット推奨箇所
1. 結果パターン管理セクション（空の状態）
2. 新規パターン作成フォーム
3. パターン一覧（パターンが表示されている状態）
4. パターン編集フォーム
5. アンケート結果画面（カスタムパターンが表示されている）

## レポート
テスト完了後、以下の情報を含むレポートを作成してください:
- テスト実施日時
- テスト環境（ブラウザ、OS）
- 成功したテストケース
- 失敗したテストケース（ある場合）
- 発見されたバグ（ある場合）
- 改善提案（ある場合）
