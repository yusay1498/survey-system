# 結果パターン編集機能 (Result Pattern Editing Feature)

## 概要

このPRは、管理者ダッシュボードから結果パターンを編集できる機能を追加します。

## 追加されたファイル

### API関数
- `src/features/admin/api/createResultPattern.ts` - 新しい結果パターンを作成
- `src/features/admin/api/updateResultPattern.ts` - 既存の結果パターンを更新
- `src/features/admin/api/deleteResultPattern.ts` - 結果パターンを削除

### コンポーネント
- `src/features/admin/components/ResultPatternManager.tsx` - 結果パターンの管理UI

### 更新されたファイル
- `src/features/admin/components/AdminDashboard.tsx` - ResultPatternManagerを統合

## 使い方

### 1. 管理者ダッシュボードにアクセス
1. アプリケーションを起動: `npm run dev`
2. `/admin` にアクセス
3. 管理者としてログイン

### 2. 結果パターンの作成
1. 「新規パターン作成」ボタンをクリック
2. 以下の情報を入力:
   - **パターン名**: 結果のタイトル（例: 「リーダータイプ」）
   - **メッセージ**: メインメッセージ（必須）
   - **詳細説明**: 追加の説明（オプション）
   - **条件**: 質問と選択肢の組み合わせ（少なくとも1つ必要）
   - **優先度**: マッチングの優先順位（高い方が優先）
   - **表示順序**: 管理画面での表示順序
3. 「作成」ボタンをクリック

### 3. 結果パターンの編集
1. 既存のパターンの横にある「編集」ボタンをクリック
2. フォームで内容を変更
3. 「更新」ボタンをクリック

### 4. 結果パターンの削除
1. パターンの横にある「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

## 機能の詳細

### 条件の設定
- 各結果パターンには1つ以上の条件を設定できます
- 条件は「質問」と「選択肢」のペアです
- すべての条件が満たされた場合にそのパターンが表示されます
- 「+ 条件を追加」ボタンで複数の条件を追加できます

### 優先度システム
- 優先度が高い（数値が大きい）パターンから順にチェックされます
- 最初にマッチしたパターンがユーザーに表示されます
- デフォルトは10です

### バリデーション
- パターン名とメッセージは必須です
- 少なくとも1つの有効な条件が必要です
- 条件には質問と選択肢の両方が必要です

## 実装の技術詳細

### アーキテクチャ
- **CRUD操作**: Firestore APIを使用した標準的なCRUD実装
- **状態管理**: Reactのローカル状態（useState）を使用
- **フォーム処理**: 制御されたコンポーネントパターン

### 主要な関数
```typescript
// 新規作成
createResultPattern(pattern: Omit<ResultPattern, "id" | "createdAt">): Promise<string>

// 更新
updateResultPattern(pattern: Omit<ResultPattern, "createdAt">): Promise<void>

// 削除
deleteResultPattern(patternId: string): Promise<void>
```

## テスト方法

1. 質問を作成（質問管理セクション）
2. 結果パターンを作成:
   - パターン名: 「テストパターン」
   - メッセージ: 「これはテストです」
   - 条件: 作成した質問とその選択肢を選択
3. アンケートに回答して、条件を満たすとパターンが表示されることを確認
4. パターンを編集して内容が更新されることを確認
5. パターンを削除して削除されることを確認

## 注意事項

- 結果パターンを削除すると、そのパターンに一致する回答者には、デフォルトの完了メッセージが表示されるようになります
- 質問を削除した場合、その質問を条件に含む結果パターンは機能しなくなる可能性があります
- Firebase設定が正しく行われている必要があります（環境変数の設定）

## 今後の拡張可能性

- 部分マッチング（すべての条件ではなく、いくつかの条件を満たす）
- スコアリングシステム
- 複数の結果を同時に表示
- 結果パターンのプレビュー機能
- インポート/エクスポート機能
